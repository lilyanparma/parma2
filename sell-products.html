
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام البيع الذكي</title>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="data/firebase-config.js"></script>
       <style>
   :root{--primary:#4361ee;--primary-dark:#3a56d4;--secondary:#3f37c9;--success:#4cc9f0;--danger:#f72585;--warning:#f8961e;--light:#f8f9fa;--dark:#212529;--gray:#6c757d}*{box-sizing:border-box;margin:0;padding:0;font-family:'Tajawal',sans-serif}body{background-color:#f0f2f5;color:var(--dark);line-height:1.6;min-height:100vh}.container{max-width:1000px;margin:0 auto;padding:20px}.header-container{background:linear-gradient(145deg,#4361ee,#3a0ca3);padding:25px;border-radius:20px;box-shadow:0 15px 30px rgba(67,97,238,0.3);margin-bottom:20px;position:relative;overflow:hidden;text-align:center;border:1px solid rgba(255,255,255,0.1)}.header-container::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);transform:rotate(30deg);z-index:1}.header{position:relative;z-index:2}.header h1{color:white;font-size:2.5rem;text-shadow:0 2px 10px rgba(0,0,0,0.3);margin:0;padding:10px 0;letter-spacing:1px;position:relative;display:inline-block}.header h1::after{content:'';position:absolute;bottom:0;left:25%;width:50%;height:3px;background:rgba(255,255,255,0.5);border-radius:3px}.mode-selection-container{display:flex;justify-content:center;margin-bottom:20px;background:#e0e5ec;padding:8px;border-radius:50px;box-shadow:inset 5px 5px 10px #a3b1c6,inset -5px -5px 10px #ffffff;gap:8px}.sale-mode-btn{flex:1;padding:10px 20px;border:none;border-radius:50px;cursor:pointer;font-weight:700;font-size:1rem;color:var(--gray);background:transparent;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;gap:8px}.sale-mode-btn.active{background:linear-gradient(145deg,var(--primary),var(--primary-dark));color:white;box-shadow:0 4px 15px rgba(67,97,238,0.4);transform:translateY(-2px)}.return-btn{background:linear-gradient(145deg,var(--warning),#f3722c);color:white;box-shadow:0 4px 15px rgba(248,150,30,0.4)}.search-container{display:flex;justify-content:center;margin:20px 0 30px;flex-direction:column;align-items:center;gap:15px}.search-toggle{background:linear-gradient(145deg,#ffffff,#e6e6e6);border:none;padding:15px 25px;border-radius:50px;box-shadow:8px 8px 16px #d1d1d1,-8px -8px 16px #ffffff;cursor:pointer;font-weight:700;color:var(--primary);transition:all 0.4s;display:flex;align-items:center;gap:10px;font-size:1.1rem;margin-top:10px}.search-toggle:hover{transform:translateY(-3px);box-shadow:12px 12px 24px #c9c9c9,-12px -12px 24px #ffffff}.search-toggle:active{transform:translateY(1px);box-shadow:inset 5px 5px 10px #d1d1d1,inset -5px -5px 10px #ffffff}.search-wrapper{width:100%;max-width:700px;display:none;background:white;border-radius:50px;box-shadow:0 10px 30px rgba(0,0,0,0.1);overflow:hidden;animation:fadeIn 0.4s cubic-bezier(0.22,1,0.36,1);border:1px solid rgba(0,0,0,0.05);flex-direction:row}@keyframes fadeIn{from{opacity:0;transform:translateY(-15px)}to{opacity:1;transform:translateY(0)}}.search-input{flex:1;padding:16px 25px;border:none;font-size:1.1rem;background:transparent}.search-input:focus{outline:none}.search-actions{display:flex}.btn{padding:14px 28px;border:none;border-radius:15px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all 0.4s cubic-bezier(0.19,1,0.22,1);display:inline-flex;align-items:center;justify-content:center;gap:12px;position:relative;overflow:hidden;z-index:1;box-shadow:6px 6px 12px rgba(0,0,0,0.15),-4px -4px 10px rgba(255,255,255,0.8)}.btn::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(rgba(255,255,255,0.2),rgba(255,255,255,0));z-index:-1;border-radius:15px}.btn:hover{transform:translateY(-5px) scale(1.02);box-shadow:10px 10px 20px rgba(0,0,0,0.2),-6px -6px 15px rgba(255,255,255,0.8)}.btn:active{transform:translateY(2px) scale(0.98);box-shadow:inset 4px 4px 8px rgba(0,0,0,0.2),inset -4px -4px 8px rgba(255,255,255,0.5)}.btn-warning{background:linear-gradient(145deg,var(--warning),#f3722c);color:white;text-shadow:0 1px 2px rgba(0,0,0,0.2)}.btn-primary{background:linear-gradient(145deg,var(--primary),var(--primary-dark));color:white;text-shadow:0 1px 2px rgba(0,0,0,0.2)}.btn-success{background:linear-gradient(145deg,#38b000,#2b9348);color:white;text-shadow:0 1px 2px rgba(0,0,0,0.2)}.btn-danger{background:linear-gradient(145deg,var(--danger),#b5179e);color:white;text-shadow:0 1px 2px rgba(0,0,0,0.2)}.btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary);box-shadow:none;transition:all 0.3s}.btn-outline:hover{background:var(--primary);color:white;transform:translateY(-3px)}#cameraScanner{width:100%;max-height:450px;margin:25px 0;border-radius:20px;overflow:hidden;display:none;position:relative;box-shadow:0 15px 35px rgba(0,0,0,0.1);border:1px solid rgba(0,0,0,0.05)}#cameraScanner video{width:100%;height:auto;display:block}.scanner-overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none;background:rgba(0,0,0,0.3)}.scanner-frame{width:80%;height:200px;border:4px solid rgba(255,255,255,0.7);border-radius:15px;box-shadow:0 0 0 10000px rgba(0,0,0,0.5);margin-bottom:20px}.scanner-instruction{color:white;text-align:center;font-size:1.2rem;text-shadow:0 1px 3px rgba(0,0,0,0.5);margin-top:10px}.product-details{background:white;padding:35px;border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,0.08);display:none;margin-top:30px;animation:fadeInUp 0.5s cubic-bezier(0.22,1,0.36,1);border:1px solid rgba(0,0,0,0.03)}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.product-header{display:flex;gap:25px;margin-bottom:25px;align-items:center}.product-image{width:150px;height:150px;object-fit:cover;border-radius:15px;border:2px solid #e9ecef;box-shadow:0 5px 15px rgba(0,0,0,0.05)}.product-info{flex:1}.product-title{font-size:1.7rem;color:var(--dark);margin-bottom:10px;font-weight:700}.product-price{font-size:1.5rem;color:var(--primary);font-weight:700;margin-bottom:15px;display:flex;align-items:center;gap:10px}.product-stock{color:var(--gray);font-size:1.1rem;display:flex;align-items:center;gap:8px;transition:all 0.3s ease;padding:3px 8px;border-radius:5px;margin-bottom:10px}.product-stock.low-stock{color:var(--danger);font-weight:bold;animation:blink 1.5s infinite;background-color:rgba(248,150,30,0.1)}.product-stock.out-of-stock{color:var(--danger);font-weight:bold;animation:blink 1s infinite}.product-stock.stock-warning{color:var(--warning);font-weight:bold}.expiry-status{display:flex;align-items:center;gap:8px;font-size:1.1rem;margin-bottom:10px}.expiry-status.valid{color:#38b000;font-weight:bold}.expiry-status.near-expiry{color:var(--warning);font-weight:bold}.expiry-status.expired{color:var(--danger);font-weight:bold}.batch-card{background:white;border-radius:10px;padding:15px;margin-bottom:15px;box-shadow:0 2px 10px rgba(0,0,0,0.05);border-left:4px solid var(--primary);position:relative}.batch-header{display:flex;justify-content:space-between;margin-bottom:10px}.batch-title{font-weight:600;color:var(--dark)}.batch-quantity{color:var(--gray)}.batch-expiry{color:var(--gray);font-size:0.9rem;display:flex;align-items:center;gap:5px}.batch-expiry.valid{color:#38b000;font-weight:bold}.batch-expiry.near-expiry{color:var(--warning);font-weight:bold}.batch-expiry.expired{color:var(--danger);font-weight:bold}.batch-select-btn{position:absolute;top:10px;right:10px;background:var(--primary);color:white;border:none;border-radius:5px;padding:5px 10px;font-size:0.8rem;cursor:pointer;transition:all 0.3s}.batch-select-btn:hover{background:var(--primary-dark)}.batch-select-btn.selected{background:var(--success)}.batch-select-btn:disabled{background:var(--gray);cursor:not-allowed}.batches-container{margin-top:20px;max-height:300px;overflow-y:auto;padding:10px;border:1px solid #eee;border-radius:10px}.batches-title{font-size:1.2rem;margin-bottom:15px;color:var(--dark);font-weight:600;display:flex;align-items:center;gap:10px}@keyframes blink{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}@keyframes pulse{0%{opacity:1}50%{opacity:0.6}100%{opacity:1}}.btn:disabled{opacity:0.6;cursor:not-allowed;transform:none!important;box-shadow:none!important}.product-details-actions{display:flex;gap:10px;margin-top:20px}.discount-section{background:linear-gradient(135deg,#fff8e1,#fff3bf);padding:25px;border-radius:15px;margin:30px 0;display:none;border-left:5px solid var(--warning);box-shadow:0 5px 15px rgba(0,0,0,0.05);animation:fadeIn 0.4s ease-out}.discount-type{display:flex;gap:15px;margin-bottom:20px;border-bottom:1px solid #e9ecef;padding-bottom:15px}.discount-type-btn{flex:1;padding:12px;border:2px solid #e9ecef;border-radius:10px;background:white;cursor:pointer;transition:all 0.3s;text-align:center;font-weight:600;color:var(--gray)}.discount-type-btn.active{border-color:var(--primary);background:rgba(67,97,238,0.1);color:var(--primary);box-shadow:0 0 0 3px rgba(67,97,238,0.2)}.discount-type-btn i{margin-left:8px}.form-group{margin-bottom:20px}.form-label{display:block;margin-bottom:12px;font-weight:600;color:#495057;font-size:1.1rem;display:flex;align-items:center;gap:8px}.form-control{width:100%;padding:14px 20px;border:2px solid #e9ecef;border-radius:12px;font-size:1.1rem;transition:all 0.3s;background:white;box-shadow:inset 3px 3px 6px rgba(0,0,0,0.05)}.form-control:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 4px rgba(67,97,238,0.2),inset 3px 3px 6px rgba(0,0,0,0.05)}.payment-methods{display:flex;gap:15px;margin:25px 0;flex-wrap:wrap}.payment-method{flex:1;min-width:120px;padding:15px;border:2px solid #e9ecef;border-radius:12px;background:white;cursor:pointer;transition:all 0.3s;text-align:center;font-weight:600;color:var(--gray)}.payment-method.active{border-color:var(--primary);background:rgba(67,97,238,0.1);color:var(--primary);box-shadow:0 0 0 3px rgba(67,97,238,0.2)}.payment-method i{font-size:1.5rem;margin-bottom:10px;display:block;color:inherit}.final-price{background:linear-gradient(135deg,#e6f7ff,#b3e0ff);padding:25px;border-radius:15px;text-align:center;margin:30px 0;border:2px dashed var(--primary);box-shadow:0 5px 15px rgba(0,0,0,0.05)}.final-price-label{font-size:1.2rem;color:var(--gray);margin-bottom:10px;font-weight:600}.final-price-value{font-size:2.2rem;color:var(--primary);font-weight:700}.action-buttons{display:flex;gap:20px;margin-top:30px}.toast{position:fixed;top:40px;right:40px;padding:20px 30px;background:linear-gradient(135deg,var(--primary),var(--secondary));color:white;border-radius:15px;box-shadow:0 15px 35px rgba(67,97,238,0.3);display:none;z-index:2000;animation:slideInRight 0.5s cubic-bezier(0.22,1,0.36,1);border-left:6px solid white;max-width:400px}@keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}.toast.hide{animation:slideOutRight 0.5s cubic-bezier(0.22,1,0.36,1);transform:translateX(100%);opacity:0}@keyframes slideOutRight{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:1000;display:none;animation:fadeIn 0.3s}.confirmation-modal{background:white;padding:25px;border-radius:15px;width:90%;max-width:400px;box-shadow:0 5px 15px rgba(0,0,0,0.2);text-align:center}.confirmation-modal h3{margin-top:0;color:var(--primary)}.confirmation-modal p{margin-bottom:20px}.modal-actions{display:flex;gap:10px;justify-content:center}.modal-actions button{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}.modal-actions .confirm-btn{background:var(--success);color:white}.modal-actions .cancel-btn{background:var(--danger);color:white}.reason-input{width:100%;padding:10px;margin:15px 0;border:1px solid #ddd;border-radius:8px}.return-success-notice{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--success);color:white;padding:20px 30px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.2);z-index:1001;display:none;text-align:center;animation:fadeIn 0.3s}.return-success-notice i{font-size:2rem;margin-bottom:10px}#invoicePlaceholder{display:none}.quantity-modal{background:white;padding:25px;border-radius:15px;width:90%;max-width:400px;box-shadow:0 5px 15px rgba(0,0,0,0.2);text-align:center}.quantity-modal h3{margin-top:0;color:var(--primary)}.quantity-input{width:100%;padding:15px;margin:20px 0;border:2px solid #e9ecef;border-radius:10px;font-size:1.2rem;text-align:center}.invoice-items-container{background:white;padding:20px;border-radius:15px;box-shadow:0 5px 20px rgba(0,0,0,0.05);margin-top:30px;display:none}.invoice-items-container h3{font-size:1.4rem;color:var(--dark);margin-bottom:20px;border-bottom:2px solid #eee;padding-bottom:10px}.invoice-items-list{list-style:none;padding:0;margin:0}.invoice-item-card{display:flex;align-items:center;justify-content:space-between;background:#f8f9fa;border:1px solid #e9ecef;border-radius:10px;padding:15px;margin-bottom:10px;box-shadow:0 2px 8px rgba(0,0,0,0.03)}.invoice-item-card.returnable-item{border-left:5px solid var(--warning)}.invoice-item-info{flex-grow:1}.invoice-item-name{font-weight:600;color:var(--primary-dark);font-size:1.1rem}.invoice-item-details{font-size:0.95rem;color:var(--gray);margin-top:5px}.invoice-item-batch-info{display:flex;align-items:center;gap:10px;margin-top:4px}.change-batch-btn{background:none;border:1px solid var(--primary);color:var(--primary);padding:2px 8px;border-radius:5px;font-size:0.8rem;cursor:pointer;transition:all 0.3s}.change-batch-btn:hover{background:var(--primary);color:white}.invoice-item-actions{display:flex;align-items:center;gap:10px}.invoice-item-quantity-input{width:60px;padding:8px;border:1px solid #ccc;border-radius:5px;text-align:center;font-size:1rem}.invoice-item-remove-btn{background:var(--danger);color:white;border:none;border-radius:5px;padding:8px 12px;cursor:pointer;transition:background 0.3s}.invoice-item-remove-btn:hover{background:#cc0052}.invoice-total-display{text-align:end;margin-top:20px;font-size:1.5rem;font-weight:700;color:var(--dark);border-top:2px dashed #eee;padding-top:15px}.invoice-total-display span{color:var(--primary)}@media (max-width:768px){.container{padding:15px}.header-container{padding:20px 15px;border-radius:15px}.header h1{font-size:1.8rem}.mode-selection-container{flex-direction:column;border-radius:20px}.sale-mode-btn{font-size:0.9rem}.search-toggle{padding:12px 20px;font-size:1rem}.search-wrapper{flex-direction:column;border-radius:15px}.search-input{padding:14px 20px;font-size:1rem}.search-actions{width:100%}#cameraBtn{border-radius:0 0 15px 15px!important;width:100%}.product-header{flex-direction:column;gap:20px}.product-image{width:120px;height:120px}.product-title{font-size:1.4rem;text-align:center}.product-price,.product-stock{justify-content:center}.product-details-actions{flex-direction:column}.discount-type{flex-direction:column}.payment-methods{flex-direction:column}.payment-method{min-width:100%}.action-buttons{flex-direction:column;gap:15px}.btn{width:100%}.toast{top:20px;right:20px;left:20px;max-width:none}.confirmation-modal{padding:20px 15px}.invoice-item-card{flex-direction:column;align-items:flex-start;gap:10px}.invoice-item-actions{width:100%;justify-content:flex-end}}
    </style>
</head>
<body>
<script>
const _0x4a48b6=_0x5593;(function(_0x1b09d7,_0xc79c78){const _0x2b3be8=_0x5593,_0x162c5=_0x1b09d7();while(!![]){try{const _0xc9c30a=-parseInt(_0x2b3be8(0x304))/0x1+-parseInt(_0x2b3be8(0x1bd))/0x2+-parseInt(_0x2b3be8(0x27c))/0x3+parseInt(_0x2b3be8(0x1cd))/0x4+parseInt(_0x2b3be8(0x2d2))/0x5*(-parseInt(_0x2b3be8(0x2c6))/0x6)+-parseInt(_0x2b3be8(0x18d))/0x7*(-parseInt(_0x2b3be8(0x2cd))/0x8)+parseInt(_0x2b3be8(0x189))/0x9;if(_0xc9c30a===_0xc79c78)break;else _0x162c5['push'](_0x162c5['shift']());}catch(_0x1d904c){_0x162c5['push'](_0x162c5['shift']());}}}(_0xdbb1,0xd09b6));const _0x395065=(function(){let _0x41ab72=!![];return function(_0x3a0419,_0xc4068){const _0x4c2143=_0x41ab72?function(){if(_0xc4068){const _0x4c131d=_0xc4068['apply'](_0x3a0419,arguments);return _0xc4068=null,_0x4c131d;}}:function(){};return _0x41ab72=![],_0x4c2143;};}()),_0x6e180e=_0x395065(this,function(){const _0x499714=_0x5593;let _0x1580c5;try{if(_0x499714(0x24a)===_0x499714(0x24a)){const _0x5787ad=Function(_0x499714(0x183)+_0x499714(0x1b7)+');');_0x1580c5=_0x5787ad();}else _0x22bef7['addEventListener'](_0x499714(0x168),function(){const _0x1ae95d=_0x499714;_0x505789(_0x24a0a0(this[_0x1ae95d(0x2a6)][_0x1ae95d(0x190)]));});}catch(_0x54581a){_0x499714(0x240)!==_0x499714(0x240)?_0x3c4f25['classList']['toggle'](_0x499714(0x159),_0x1e6c15['dataset'][_0x499714(0x1b8)]===_0xba4e46['id']):_0x1580c5=window;}const _0x4fb096=new RegExp(_0x499714(0x2f1),'g'),_0x284acf=_0x499714(0x307)['replace'](_0x4fb096,'')[_0x499714(0x2c7)](';');let _0x3abc61,_0x3d115d,_0x3fc7f5,_0x25ae52;const _0x514619=function(_0x52a45c,_0x289207,_0x274460){const _0x2403b0=_0x499714;if('fKyTM'===_0x2403b0(0x21a))_0x5aa561=_0x28aecc;else{if(_0x52a45c[_0x2403b0(0x1b1)]!=_0x289207){if('HAcgm'===_0x2403b0(0x2c1)){const _0x42f6f5=_0x302353(_0x16c28a['invoiceDiscountPercent'][_0x2403b0(0x279)])||0x0;if(_0x42f6f5<0x0||_0x42f6f5>0x64){_0x3f0eef(_0x2403b0(0x2d0),_0x2403b0(0x275));return;}_0x49f64d=_0x42f6f5,_0x21648a=_0x2403b0(0x2b7);}else return![];}for(let _0x4bc3b7=0x0;_0x4bc3b7<_0x289207;_0x4bc3b7++){if('fONQz'===_0x2403b0(0x21e)){const _0x194837=_0x158ad1[_0x537c1d],_0x2d3ee5=_0x194837[0x0]===_0x32e8ac[_0x2403b0(0x2a4)](0x2e)?_0x194837[_0x2403b0(0x1e9)](0x1):_0x194837,_0x4183a7=_0x26f2a2[_0x2403b0(0x1b1)]-_0x2d3ee5['length'],_0x58a874=_0x585d46[_0x2403b0(0x184)](_0x2d3ee5,_0x4183a7),_0x2419f9=_0x58a874!==-0x1&&_0x58a874===_0x4183a7;_0x2419f9&&((_0x25ae15[_0x2403b0(0x1b1)]==_0x194837[_0x2403b0(0x1b1)]||_0x194837[_0x2403b0(0x184)]('.')===0x0)&&(_0x39a14f=!![]));}else for(let _0x4a41c1=0x0;_0x4a41c1<_0x274460[_0x2403b0(0x1b1)];_0x4a41c1+=0x2){if('cjdxp'!==_0x2403b0(0x169)){_0x12746e(_0x2403b0(0x188),_0x2403b0(0x275));return;}else{if(_0x4bc3b7==_0x274460[_0x4a41c1]&&_0x52a45c[_0x2403b0(0x210)](_0x4bc3b7)!=_0x274460[_0x4a41c1+0x1])return![];}}}return!![];}},_0x190603=function(_0x3f4e5a,_0x348dd5,_0x1f2545){return _0x514619(_0x348dd5,_0x1f2545,_0x3f4e5a);},_0x9b03e=function(_0xa09b2f,_0x39db02,_0x476da5){return _0x190603(_0x39db02,_0xa09b2f,_0x476da5);},_0x375b8d=function(_0x42ef6c,_0x2a87b8,_0x3a1a0a){return _0x9b03e(_0x2a87b8,_0x3a1a0a,_0x42ef6c);};for(let _0x17f1b7 in _0x1580c5){if(_0x514619(_0x17f1b7,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3abc61=_0x17f1b7;break;}}for(let _0x1cba20 in _0x1580c5[_0x3abc61]){if(_0x499714(0x182)!=='ANNVm'){_0x338de9[_0x499714(0x28a)]=_0x499714(0x2be),_0x5df547['className']=_0x499714(0x171);return;}else{if(_0x375b8d(0x6,_0x1cba20,[0x5,0x6e,0x0,0x64])){if('YVcaM'!=='ROmXQ'){_0x3d115d=_0x1cba20;break;}else _0x9565a0(_0x3af452[_0x499714(0x1c5)]);}}}for(let _0x2c8c68 in _0x1580c5[_0x3abc61]){if(_0x9b03e(_0x2c8c68,[0x7,0x6e,0x0,0x6c],0x8)){if('HSYWj'===_0x499714(0x272)){_0x3fc7f5=_0x2c8c68;break;}else{if(!_0x2cc49d)return 0x0;return _0x34f8af[_0x499714(0x178)](_0x1641ef)[_0x499714(0x2c8)]((_0x598328,_0x4bfbb6)=>_0x598328+(_0x235e75(_0x4bfbb6[_0x499714(0x24b)])||0x0),0x0);}}}if(!('~'>_0x3d115d)){if(_0x499714(0x2bc)!==_0x499714(0x1bc))for(let _0x5caa3f in _0x1580c5[_0x3abc61][_0x3fc7f5]){if(_0x499714(0x219)===_0x499714(0x219)){if(_0x190603([0x7,0x65,0x0,0x68],_0x5caa3f,0x8)){_0x25ae52=_0x5caa3f;break;}}else _0x31e1f2[_0x499714(0x24e)]===_0x499714(0x2c5)&&(_0xa9106b['invoicePlaceholder'][_0x499714(0x258)][_0x499714(0x2fc)]=_0x499714(0x305),_0xd10289());}else{_0x2f2865['batchesContainer'][_0x499714(0x28a)]+=_0x499714(0x1c9);return;}}if(!_0x3abc61||!_0x1580c5[_0x3abc61]){if(_0x499714(0x2d7)!==_0x499714(0x179))return;else _0x4b4ff6(_0x3dc8e3);}const _0xd535a8=_0x1580c5[_0x3abc61][_0x3d115d],_0x1a04bd=!!_0x1580c5[_0x3abc61][_0x3fc7f5]&&_0x1580c5[_0x3abc61][_0x3fc7f5][_0x25ae52],_0x3dbc4b=_0xd535a8||_0x1a04bd;if(!_0x3dbc4b){if(_0x499714(0x1c1)===_0x499714(0x1c1))return;else{const _0x542ed2=_0x49914b[_0x499714(0x2f2)](_0x392fc1=>_0x392fc1[_0x499714(0x264)][_0x499714(0x221)]===_0x1bc463['barcode']&&_0x392fc1[_0x499714(0x300)]['id']===_0x5adf46['id']);if(_0x542ed2!==-0x1){const _0x3f928c=_0x58b925[_0x499714(0x24b)]+_0x3bc3bc[_0x542ed2][_0x499714(0x24b)];if(_0x181160>_0x3f928c){_0xd24549(_0x499714(0x267)+_0x437db2+_0x499714(0x243)+_0x3f928c+')','error');return;}_0x71d7e2[_0x542ed2][_0x499714(0x24b)]=_0x5aa935,_0x3972c0[_0x542ed2]['itemTotal']=_0x10d4c2*_0x4a2640[_0x542ed2]['product'][_0x499714(0x2bf)],_0x3f31e3('تم\x20تحديث\x20كمية\x20المنتج','success');}}}let _0x424d39=![];for(let _0x1cce74=0x0;_0x1cce74<_0x284acf['length'];_0x1cce74++){if(_0x499714(0x1b4)!==_0x499714(0x2a3)){const _0x4d2cb3=_0x284acf[_0x1cce74],_0x126b34=_0x4d2cb3[0x0]===String[_0x499714(0x2a4)](0x2e)?_0x4d2cb3[_0x499714(0x1e9)](0x1):_0x4d2cb3,_0x460ab1=_0x3dbc4b['length']-_0x126b34[_0x499714(0x1b1)],_0x364e30=_0x3dbc4b[_0x499714(0x184)](_0x126b34,_0x460ab1),_0x3ef9cb=_0x364e30!==-0x1&&_0x364e30===_0x460ab1;_0x3ef9cb&&((_0x3dbc4b['length']==_0x4d2cb3['length']||_0x4d2cb3['indexOf']('.')===0x0)&&(_0x499714(0x2bd)!==_0x499714(0x196)?_0x424d39=!![]:(_0x3aec8b['innerHTML']='<i\x20class=\x22fas\x20fa-boxes\x22></i>\x20<span\x20class=\x22low-stock\x20stock-warning\x22>المخزون:\x20'+_0x4d0fc1+'\x20قطع</span>',_0x588788[_0x499714(0x289)]=_0x499714(0x249))));}else return _0x2c9015(_0x291446,_0x2fc5e2,_0xb409f9);}if(!_0x424d39){if(_0x499714(0x1ee)===_0x499714(0x237)){const _0x16b271={'product':{'barcode':_0x517d25['barcode'],'name':_0x1c0396[_0x499714(0x1b6)],'price':_0x4e0e23[_0x499714(0x2bf)],'cost':_0x1f1bd7[_0x499714(0x302)],'image':_0x23097e['image']},'batch':{'id':_0x4be112['id'],'batchNumber':_0x113be1[_0x499714(0x273)],'expiryDate':_0x33fa4c[_0x499714(0x162)]},'quantity':_0x4407ea,'itemTotal':_0x510c17[_0x499714(0x2bf)]*_0xc4b1f6};_0x159e21[_0x499714(0x2a1)](_0x16b271);}else{const _0xe22e33=new RegExp(_0x499714(0x1ff),'g'),_0xa7c506=_0x499714(0x2dd)[_0x499714(0x303)](_0xe22e33,'');_0x1580c5[_0x3abc61][_0x3fc7f5]=_0xa7c506;}}});_0x6e180e(),document[_0x4a48b6(0x29b)]('\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1><i\x20class=\x22fas\x20fa-cash-register\x22></i>\x20نظام\x20البيع\x20الذكي</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22actions-bar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mode-selection-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22manualModeBtn\x22\x20class=\x22sale-mode-btn\x20active\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-hand-pointer\x22></i>\x20بيع\x20يدوي\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22quickModeBtn\x22\x20class=\x22sale-mode-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-bolt\x22></i>\x20بيع\x20سريع\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22returnModeBtn\x22\x20class=\x22btn\x20btn-warning\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-undo-alt\x22></i>\x20إرجاع\x20المنتجات\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22searchToggle\x22\x20class=\x22search-toggle\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-search\x22></i>\x20بحث\x20عن\x20منتج\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22searchWrapper\x22\x20class=\x22search-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type=\x22text\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22barcodeInput\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22search-input\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22امسح\x20الباركود\x20أو\x20أدخله\x20يدوياً...\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20autocomplete=\x22off\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22cameraBtn\x22\x20class=\x22btn\x20btn-primary\x22\x20style=\x22border-radius:\x200\x2050px\x2050px\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-camera\x22></i>\x20مسح\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22cameraScanner\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<video\x20muted\x20playsinline></video>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22scanner-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22scanner-frame\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22scanner-instruction\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-barcode\x20fa-3x\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>وجه\x20الكاميرا\x20نحو\x20الباركود</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22productDetails\x22\x20class=\x22product-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20id=\x22productImage\x22\x20class=\x22product-image\x22\x20src=\x22\x22\x20alt=\x22صورة\x20المنتج\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20id=\x22productName\x22\x20class=\x22product-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-tag\x22></i>\x20اسم\x20المنتج\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22basePrice\x22\x20class=\x22product-price\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-tags\x22></i>\x200.00\x20د.م\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22productQuantity\x22\x20class=\x22product-stock\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-boxes\x22></i>\x20المخزون:\x200\x20قطع\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22productExpiry\x22\x20class=\x22expiry-status\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-calendar-alt\x22></i>\x20تاريخ\x20الصلاحية:\x20غير\x20محدد\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batches-container\x22\x20id=\x22batchesContainer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22batches-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-box-open\x22></i>\x20الدفعات\x20المتاحة\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-details-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22addToInvoiceBtn\x22\x20class=\x22btn\x20btn-primary\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-cart-plus\x22></i>\x20إضافة\x20إلى\x20الفاتورة\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22updateInvoiceItemBtn\x22\x20class=\x22btn\x20btn-warning\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x20تحديث\x20الدفعة\x20في\x20الفاتورة\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoiceItemsContainer\x22\x20class=\x22invoice-items-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3><i\x20class=\x22fas\x20fa-file-invoice\x22></i>\x20المنتجات\x20في\x20الفاتورة</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20id=\x22invoiceItemsList\x22\x20class=\x22invoice-items-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-total-display\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20الإجمالي\x20الفرعي:\x20<span\x20id=\x22subTotalValue\x22>0.00\x20د.م</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22applyInvoiceDiscount\x22\x20class=\x22btn\x20btn-outline\x22\x20style=\x22margin-top:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-percentage\x22></i>\x20إضافة\x20خصم\x20على\x20الفاتورة\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoiceDiscountSection\x22\x20class=\x22discount-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22discount-type\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoicePercentDiscountBtn\x22\x20class=\x22discount-type-btn\x20active\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-percent\x22></i>\x20نسبة\x20مئوية\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoiceFixedDiscountBtn\x22\x20class=\x22discount-type-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-money-bill-wave\x22></i>\x20خصم\x20بالدرهم\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoicePercentDiscountGroup\x22\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22invoiceDiscountPercent\x22\x20class=\x22form-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-percent\x22></i>\x20نسبة\x20الخصم\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22invoiceDiscountPercent\x22\x20class=\x22form-control\x22\x20min=\x220\x22\x20max=\x22100\x22\x20placeholder=\x2210\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoiceFixedDiscountGroup\x22\x20class=\x22form-group\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22invoiceDiscountAmount\x22\x20class=\x22form-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-money-bill-wave\x22></i>\x20مبلغ\x20الخصم\x20(د.م)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22invoiceDiscountAmount\x22\x20class=\x22form-control\x22\x20min=\x220\x22\x20placeholder=\x225.00\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22invoiceReasonInput\x22\x20class=\x22form-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comment-alt\x22></i>\x20سبب\x20الخصم\x20(اختياري)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22invoiceReasonInput\x22\x20class=\x22form-control\x22\x20placeholder=\x22مثال:\x20خصم\x20خاص،\x20تخفيض...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22confirmInvoiceDiscount\x22\x20class=\x22btn\x20btn-primary\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-circle\x22></i>\x20تطبيق\x20الخصم\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-methods\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22cashPayment\x22\x20class=\x22payment-method\x20active\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-money-bill-wave\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20نقداً\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22cardPayment\x22\x20class=\x22payment-method\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-credit-card\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20بطاقة\x20بنكية\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22transferPayment\x22\x20class=\x22payment-method\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exchange-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20تحويل\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22final-price\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22final-price-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-receipt\x22></i>\x20السعر\x20النهائي\x20للفاتورة\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22finalInvoicePriceValue\x22\x20class=\x22final-price-value\x22>0.00\x20د.م</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-buttons\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22confirmSaleBtn\x22\x20class=\x22btn\x20btn-success\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-cash-register\x22></i>\x20تأكيد\x20البيع\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22cancelInvoiceBtn\x22\x20class=\x22btn\x20btn-danger\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times-circle\x22></i>\x20إلغاء\x20الفاتورة\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoicePlaceholder\x22></div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22returnCenterModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22confirmation-modal\x22\x20style=\x22max-width:\x20700px;\x20text-align:\x20right;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20margin-bottom:\x2015px;\x20border-bottom:\x201px\x20solid\x20#eee;\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin:\x200;\x22><i\x20class=\x22fas\x20fa-undo-alt\x22></i>\x20مركز\x20إرجاع\x20المنتجات</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22closeReturnCenterBtn\x22\x20style=\x22background:none;\x20border:none;\x20font-size:\x201.8rem;\x20cursor:pointer;\x20color:\x20var(--gray);\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--gray);\x20margin-bottom:\x2020px;\x22>ابحث\x20عن\x20الفاتورة\x20الأصلية\x20باستخدام\x20رقمها\x20أو\x20باركود\x20أحد\x20منتجاتها.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoiceSearchWrapper\x22\x20class=\x22search-wrapper\x22\x20style=\x22display:\x20flex;\x20width:\x20100%;\x20border-radius:\x2010px;\x20margin-bottom:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22invoiceSearchInput\x22\x20class=\x22search-input\x22\x20placeholder=\x22أدخل\x20رقم\x20الفاتورة\x20أو\x20الباركود...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22searchInvoiceBtn\x22\x20class=\x22btn\x20btn-primary\x22\x20style=\x22border-radius:\x200\x2010px\x2010px\x200;\x22><i\x20class=\x22fas\x20fa-search\x22></i>\x20بحث</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22invoiceSearchResult\x22\x20style=\x22margin-top:\x2020px;\x20max-height:\x2050vh;\x20overflow-y:\x20auto;\x20padding:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22returnConfirmModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22confirmation-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3><i\x20class=\x22fas\x20fa-undo-alt\x22></i>\x20تأكيد\x20إرجاع\x20المنتج</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20id=\x22returnConfirmText\x22>هل\x20أنت\x20متأكد\x20من\x20إرجاع\x20هذا\x20المنتج؟</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22returnQuantityInput\x22\x20class=\x22form-label\x22\x20style=\x22justify-content:\x20center;\x22>الكمية\x20المرتجعة</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22returnQuantityInput\x22\x20class=\x22quantity-input\x22\x20min=\x221\x22\x20value=\x221\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22returnReasonInput\x22\x20class=\x22reason-input\x22\x20placeholder=\x22سبب\x20الإرجاع\x20(اختياري)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22confirmReturnBtn\x22\x20class=\x22confirm-btn\x22><i\x20class=\x22fas\x20fa-check\x22></i>\x20تأكيد</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22cancelReturnBtn\x22\x20class=\x22cancel-btn\x22><i\x20class=\x22fas\x20fa-times\x22></i>\x20إلغاء</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22quantityModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quantity-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3><i\x20class=\x22fas\x20fa-shopping-cart\x22></i>\x20كمية\x20البيع</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22quantityInput\x22\x20class=\x22quantity-input\x22\x20min=\x221\x22\x20value=\x221\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22confirmQuantityBtn\x22\x20class=\x22confirm-btn\x22><i\x20class=\x22fas\x20fa-check\x22></i>\x20تأكيد</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22cancelQuantityBtn\x22\x20class=\x22cancel-btn\x22><i\x20class=\x22fas\x20fa-times\x22></i>\x20إلغاء</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22returnSuccessNotice\x22\x20class=\x22return-success-notice\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h3>تم\x20الإرجاع\x20بنجاح</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20id=\x22returnSuccessText\x22></p>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22toast\x22\x20class=\x22toast\x22></div>\x0a'),document['addEventListener'](_0x4a48b6(0x1fd),function(){const _0x383a67=_0x4a48b6;firebase[_0x383a67(0x2b6)]()[_0x383a67(0x231)](function(_0x4f05b6){const _0x41542c=_0x383a67;if(_0x4f05b6)console[_0x41542c(0x2e8)](_0x41542c(0x250));else{if(_0x41542c(0x192)===_0x41542c(0x192))window[_0x41542c(0x241)][_0x41542c(0x25c)]=_0x41542c(0x1bb);else{_0x396ca3[_0x41542c(0x2a9)]['value']='',_0x4d1e83[_0x41542c(0x1e8)]['style'][_0x41542c(0x2fc)]=_0x41542c(0x305),_0x2197e0[_0x41542c(0x2c0)]['style']['display']=_0x41542c(0x305),_0x5d0b6d[_0x41542c(0x2f7)][_0x41542c(0x258)]['display']='none';_0x52e866[_0x41542c(0x259)]['style'][_0x41542c(0x2fc)]!==_0x41542c(0x223)&&_0x2bd161();_0x1ea466(),_0x32e4bb=[],_0xd2f9de={'type':_0x41542c(0x305),'value':0x0,'reason':''},_0x10223a=0x0,_0x211ac1=0x0,_0x32efc2(),_0x5e30d8(),_0x3d5966[_0x41542c(0x16f)][_0x41542c(0x279)]='',_0x306f11[_0x41542c(0x2b2)][_0x41542c(0x279)]='',_0x23e7ab[_0x41542c(0x25f)][_0x41542c(0x279)]='',_0x319a4d(_0x41542c(0x1c6));if(_0x535d52)_0x9c51a3();}}});});const codeReader=new ZXing[(_0x4a48b6(0x1ca))]();let cameraActive=![],currentProduct=null,selectedBatch=null,paymentMethod=_0x4a48b6(0x1c6);const pharmacyName=_0x4a48b6(0x17a);let currentItemForReturn=null,saleMode=_0x4a48b6(0x26e),isUpdatingItemIndex=null,invoiceItems=[],invoiceOverallDiscount={'type':'none','value':0x0,'reason':''},currentSubTotal=0x0,currentFinalInvoicePrice=0x0;const elements={'manualModeBtn':document[_0x4a48b6(0x1c4)]('manualModeBtn'),'quickModeBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x224)),'returnModeBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2eb)),'searchToggle':document[_0x4a48b6(0x1c4)]('searchToggle'),'searchWrapper':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x259)),'barcodeInput':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2a9)),'cameraBtn':document['getElementById'](_0x4a48b6(0x296)),'cameraScanner':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x23b)),'productDetails':document[_0x4a48b6(0x1c4)]('productDetails'),'productImage':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x16b)),'productName':document['getElementById']('productName'),'basePrice':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2f4)),'productQuantity':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x29f)),'productExpiry':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x26d)),'batchesContainer':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x1d0)),'addToInvoiceBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x19d)),'updateInvoiceItemBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x15f)),'invoiceItemsContainer':document['getElementById']('invoiceItemsContainer'),'invoiceItemsList':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x1e3)),'subTotalValue':document[_0x4a48b6(0x1c4)]('subTotalValue'),'applyInvoiceDiscount':document['getElementById']('applyInvoiceDiscount'),'invoiceDiscountSection':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2f7)),'invoicePercentDiscountBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x1ce)),'invoiceFixedDiscountBtn':document['getElementById'](_0x4a48b6(0x22a)),'invoicePercentDiscountGroup':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x24c)),'invoiceFixedDiscountGroup':document[_0x4a48b6(0x1c4)]('invoiceFixedDiscountGroup'),'invoiceDiscountPercent':document[_0x4a48b6(0x1c4)]('invoiceDiscountPercent'),'invoiceDiscountAmount':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2b2)),'invoiceReasonInput':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x25f)),'confirmInvoiceDiscount':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2ca)),'cashPayment':document['getElementById'](_0x4a48b6(0x276)),'cardPayment':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x270)),'transferPayment':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2d1)),'finalInvoicePriceValue':document[_0x4a48b6(0x1c4)]('finalInvoicePriceValue'),'confirmSaleBtn':document['getElementById'](_0x4a48b6(0x222)),'cancelInvoiceBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x19a)),'toast':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2e0)),'invoicePlaceholder':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x20f)),'quantityModal':document['getElementById']('quantityModal'),'quantityInput':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x2e9)),'confirmQuantityBtn':document['getElementById'](_0x4a48b6(0x2a2)),'cancelQuantityBtn':document[_0x4a48b6(0x1c4)]('cancelQuantityBtn'),'returnCenterModal':document[_0x4a48b6(0x1c4)]('returnCenterModal'),'closeReturnCenterBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x157)),'invoiceSearchInput':document['getElementById']('invoiceSearchInput'),'searchInvoiceBtn':document['getElementById'](_0x4a48b6(0x158)),'invoiceSearchResult':document[_0x4a48b6(0x1c4)]('invoiceSearchResult'),'returnConfirmModal':document['getElementById'](_0x4a48b6(0x208)),'returnConfirmText':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x1fc)),'returnQuantityInput':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x1f8)),'returnReasonInput':document['getElementById']('returnReasonInput'),'confirmReturnBtn':document[_0x4a48b6(0x1c4)]('confirmReturnBtn'),'cancelReturnBtn':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x19c)),'returnSuccessNotice':document['getElementById']('returnSuccessNotice'),'returnSuccessText':document[_0x4a48b6(0x1c4)](_0x4a48b6(0x203))};function getPriceRange(_0x3dc7ad){const _0x2481b7=_0x4a48b6;if(!_0x3dc7ad||Object[_0x2481b7(0x1ae)](_0x3dc7ad)['length']===0x0)return _0x2481b7(0x2a8);const _0x39b668=Object[_0x2481b7(0x178)](_0x3dc7ad)[_0x2481b7(0x1c7)](_0x581abc=>parseFloat(_0x581abc[_0x2481b7(0x2bf)]))[_0x2481b7(0x236)](_0x36f4f5=>!isNaN(_0x36f4f5)&&_0x36f4f5>0x0);if(_0x39b668['length']===0x0)return'غير\x20محدد';const _0x42e06e=Math[_0x2481b7(0x286)](..._0x39b668),_0x4b1099=Math['max'](..._0x39b668);if(_0x42e06e===_0x4b1099){if(_0x2481b7(0x165)!==_0x2481b7(0x165))_0x2aeaa2&&_0x321661(_0x3d0716[_0x2481b7(0x1c5)]),_0x221c67&&!(_0xaaf467 instanceof _0x2bdc60[_0x2481b7(0x293)])&&(_0x4802b8[_0x2481b7(0x2ea)](_0x2481b7(0x1b3),_0x781907),_0x1f5496(_0x2481b7(0x2ff),_0x2481b7(0x2ea)));else return _0x42e06e[_0x2481b7(0x2e2)](0x2)+_0x2481b7(0x2ed);}return _0x2481b7(0x1f9)+_0x42e06e[_0x2481b7(0x2e2)](0x2)+_0x2481b7(0x1ef)+_0x4b1099[_0x2481b7(0x2e2)](0x2)+_0x2481b7(0x2ed);}function displayProduct(_0xe1297){const _0x279459=_0x4a48b6;elements[_0x279459(0x1d8)][_0x279459(0x238)]=_0xe1297[_0x279459(0x1b6)];const _0x4b8f93=getPriceRange(_0xe1297[_0x279459(0x1f5)]);elements[_0x279459(0x2f4)][_0x279459(0x28a)]='<i\x20class=\x22fas\x20fa-tags\x22></i>\x20'+_0x4b8f93;const _0x20b1be=calculateTotalQuantity(_0xe1297[_0x279459(0x1f5)]),_0x423513=elements[_0x279459(0x29f)];if(_0x20b1be<=0x0)_0x423513['innerHTML']='<i\x20class=\x22fas\x20fa-boxes\x22></i>\x20<span\x20class=\x22out-of-stock\x22>انتهى\x20المخزون</span>',_0x423513[_0x279459(0x289)]=_0x279459(0x27a);else _0x20b1be<=0x5?(_0x423513[_0x279459(0x28a)]=_0x279459(0x16c)+_0x20b1be+_0x279459(0x291),_0x423513['className']='product-stock\x20low-stock'):(_0x423513['innerHTML']=_0x279459(0x2f6)+_0x20b1be+_0x279459(0x20b),_0x423513[_0x279459(0x289)]=_0x279459(0x155));updateProductExpiryStatus(_0xe1297[_0x279459(0x1f5)]),displayBatches(_0xe1297[_0x279459(0x1f5)]),elements[_0x279459(0x16b)]['src']=_0xe1297['image'],elements[_0x279459(0x1e8)]['style']['display']='block';if(isUpdatingItemIndex!==null){if(_0x279459(0x2f8)!==_0x279459(0x2f8))_0x1efbd1[_0x279459(0x2fa)](_0x279459(0x168),_0x480448);else{elements['addToInvoiceBtn'][_0x279459(0x258)][_0x279459(0x2fc)]=_0x279459(0x305),elements[_0x279459(0x15f)][_0x279459(0x258)][_0x279459(0x2fc)]=_0x279459(0x1ed);const _0xeb1d00=invoiceItems[isUpdatingItemIndex][_0x279459(0x300)]['id'],_0x4300b1=Object[_0x279459(0x178)](_0xe1297[_0x279459(0x1f5)])[_0x279459(0x2d4)](_0x1dd7bc=>_0x1dd7bc['id']===_0xeb1d00)||{'id':_0xeb1d00,...invoiceItems[isUpdatingItemIndex][_0x279459(0x300)]};if(_0x4300b1)selectBatch(_0x4300b1,!![]);}}else elements['addToInvoiceBtn'][_0x279459(0x258)][_0x279459(0x2fc)]='inline-flex',elements[_0x279459(0x15f)][_0x279459(0x258)][_0x279459(0x2fc)]=_0x279459(0x305),elements[_0x279459(0x19d)][_0x279459(0x18e)]=_0x20b1be<=0x0;selectedBatch=null;}function addProductToInvoice(_0x4bbf63,_0x18eb46,_0x2d6884){const _0x1b0bd7=_0x4a48b6,_0x9f9e07={'product':{'barcode':_0x4bbf63[_0x1b0bd7(0x221)],'name':_0x4bbf63[_0x1b0bd7(0x1b6)],'price':_0x18eb46[_0x1b0bd7(0x2bf)],'cost':_0x18eb46[_0x1b0bd7(0x302)],'image':_0x4bbf63[_0x1b0bd7(0x265)]},'batch':{'id':_0x18eb46['id'],'batchNumber':_0x18eb46[_0x1b0bd7(0x273)],'expiryDate':_0x18eb46['expiryDate']},'quantity':_0x2d6884,'itemTotal':_0x18eb46[_0x1b0bd7(0x2bf)]*_0x2d6884};invoiceItems[_0x1b0bd7(0x2a1)](_0x9f9e07);}async function handleQuickSale(_0x31956d){const _0x51817d=_0x4a48b6,_0xa3b22e=invoiceItems[_0x51817d(0x2f2)](_0x3d77a5=>_0x3d77a5[_0x51817d(0x264)][_0x51817d(0x221)]===_0x31956d[_0x51817d(0x221)]);if(_0xa3b22e!==-0x1){const _0x13b0b6=invoiceItems[_0xa3b22e],_0x41032b=_0x13b0b6['quantity']+0x1,_0x450445=await database[_0x51817d(0x1d4)]('products/'+_0x31956d[_0x51817d(0x221)]+_0x51817d(0x1f4)+_0x13b0b6[_0x51817d(0x300)]['id']+_0x51817d(0x1d2))[_0x51817d(0x207)](_0x51817d(0x279)),_0x2c6f57=_0x450445['val']();if(_0x41032b<=_0x2c6f57){if(_0x51817d(0x287)!==_0x51817d(0x287)){const _0x1a285c={'barcode':_0x3df3e2,'name':_0xa14e90['name'],'batches':_0x1c3929[_0x51817d(0x1f5)]||{},'image':_0x144a3c[_0x51817d(0x265)]||_0x51817d(0x17b),'date':_0x268989['date']||new _0x1e3975()['toISOString']()[_0x51817d(0x2c7)]('T')[0x0]};_0x54b228===_0x51817d(0x2ae)?_0x13eda5(_0x1a285c):(_0x45107b=_0x1a285c,_0x15b6fd(_0x2f655d),_0x520002(_0x51817d(0x29a),_0x51817d(0x278)));}else _0x13b0b6[_0x51817d(0x24b)]=_0x41032b,_0x13b0b6[_0x51817d(0x2f5)]=_0x13b0b6[_0x51817d(0x264)][_0x51817d(0x2bf)]*_0x41032b,showToast('+1\x20'+_0x13b0b6[_0x51817d(0x264)][_0x51817d(0x1b6)]+_0x51817d(0x247)+_0x41032b+')','info');}else _0x51817d(0x2cf)===_0x51817d(0x2cf)?showToast('لا\x20يوجد\x20مخزون\x20كافٍ\x20لـ\x20'+_0x13b0b6[_0x51817d(0x264)]['name']+'\x20في\x20هذه\x20الدفعة',_0x51817d(0x2ea)):(_0x430c67[_0x51817d(0x19d)][_0x51817d(0x258)]['display']=_0x51817d(0x1ed),_0x36a98e['updateInvoiceItemBtn'][_0x51817d(0x258)][_0x51817d(0x2fc)]=_0x51817d(0x305),_0x58049c[_0x51817d(0x19d)][_0x51817d(0x18e)]=_0x492b91<=0x0);}else{const _0x5b24bc=_0x31956d[_0x51817d(0x1f5)];if(!_0x5b24bc||Object[_0x51817d(0x1ae)](_0x5b24bc)['length']===0x0){showToast('المنتج\x20'+_0x31956d[_0x51817d(0x1b6)]+_0x51817d(0x217),_0x51817d(0x2ea));return;}const _0x47f5a1=new Date();_0x47f5a1['setHours'](0x0,0x0,0x0,0x0);const _0x574ab5=Object['entries'](_0x5b24bc)['map'](([_0x38aef7,_0x55408f])=>({'id':_0x38aef7,..._0x55408f}))[_0x51817d(0x236)](_0x56bf78=>{const _0x204147=_0x51817d;if(_0x204147(0x229)===_0x204147(0x229)){const _0x3d34de=new Date(_0x56bf78[_0x204147(0x162)]);return _0x56bf78['quantity']>0x0&&_0x3d34de>=_0x47f5a1;}else _0x99f77a(_0x34ded8,_0x5761b0[_0x204147(0x268)]()[_0x204147(0x1b6)],_0x5deeea[_0x204147(0x268)]()[_0x204147(0x1f6)]);});if(_0x574ab5['length']===0x0){if(_0x51817d(0x201)!==_0x51817d(0x201)){_0x199050('قيمة\x20الخصم\x20يجب\x20أن\x20تكون\x20موجبة',_0x51817d(0x275));return;}else{showToast(_0x51817d(0x25b)+_0x31956d[_0x51817d(0x1b6)],_0x51817d(0x2ea));return;}}_0x574ab5[_0x51817d(0x22f)]((_0x171493,_0xe326a2)=>new Date(_0x171493[_0x51817d(0x162)])-new Date(_0xe326a2[_0x51817d(0x162)]));const _0x4c005a=_0x574ab5[0x0];addProductToInvoice(_0x31956d,_0x4c005a,0x1),showToast(_0x51817d(0x161)+_0x31956d['name']+'\x20(من\x20دفعة\x20'+(_0x4c005a[_0x51817d(0x273)]||'الأقدم')+')','success');}displayInvoiceItems(),calculateAndDisplayTotals(),elements[_0x51817d(0x2a9)][_0x51817d(0x279)]='',elements['barcodeInput'][_0x51817d(0x2dc)]();}elements[_0x4a48b6(0x1ba)][_0x4a48b6(0x2fa)]('click',function(){toggleSearch();}),elements[_0x4a48b6(0x1d5)]['addEventListener']('click',()=>{const _0x294f02=_0x4a48b6;saleMode=_0x294f02(0x26e),elements[_0x294f02(0x1d5)][_0x294f02(0x1a3)][_0x294f02(0x2c3)](_0x294f02(0x1b2)),elements[_0x294f02(0x224)][_0x294f02(0x1a3)][_0x294f02(0x197)](_0x294f02(0x1b2)),elements[_0x294f02(0x2a9)][_0x294f02(0x1e2)]=_0x294f02(0x19e),showToast(_0x294f02(0x212),'info');}),elements[_0x4a48b6(0x224)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),()=>{const _0x1fe4d5=_0x4a48b6;saleMode=_0x1fe4d5(0x2ae),elements[_0x1fe4d5(0x224)][_0x1fe4d5(0x1a3)][_0x1fe4d5(0x2c3)](_0x1fe4d5(0x1b2)),elements[_0x1fe4d5(0x1d5)][_0x1fe4d5(0x1a3)][_0x1fe4d5(0x197)](_0x1fe4d5(0x1b2)),elements['productDetails']['style'][_0x1fe4d5(0x2fc)]=_0x1fe4d5(0x305),elements['barcodeInput'][_0x1fe4d5(0x1e2)]=_0x1fe4d5(0x2af),showToast(_0x1fe4d5(0x1e4),_0x1fe4d5(0x278));});function toggleSearch(){const _0x27a4c5=_0x4a48b6,_0x4d4532=elements[_0x27a4c5(0x259)][_0x27a4c5(0x258)][_0x27a4c5(0x2fc)]===_0x27a4c5(0x223);elements['searchWrapper'][_0x27a4c5(0x258)]['display']=_0x4d4532?'none':_0x27a4c5(0x223),!_0x4d4532&&(elements[_0x27a4c5(0x2a9)][_0x27a4c5(0x2dc)](),elements[_0x27a4c5(0x2a9)]['value'][_0x27a4c5(0x15c)]()&&processScanOrSearch());}elements['cameraBtn']['addEventListener'](_0x4a48b6(0x168),toggleCamera);async function toggleCamera(){const _0x4c0f8f=_0x4a48b6;cameraActive?_0x4c0f8f(0x29d)!==_0x4c0f8f(0x29d)?(_0x1102fb[_0x4c0f8f(0x15a)][_0x4c0f8f(0x28a)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--danger);\x22>حدث\x20خطأ\x20أثناء\x20البحث.</p>',_0x473bd8[_0x4c0f8f(0x2ea)](_0x4c0f8f(0x23e),_0x394019)):await stopCamera():await startCamera();}async function startCamera(){const _0x19e58f=_0x4a48b6;try{_0x19e58f(0x27f)!==_0x19e58f(0x27f)?(_0x44e338['innerHTML']=_0x19e58f(0x191),_0x25a842['className']=_0x19e58f(0x27a)):(elements[_0x19e58f(0x23b)]['style'][_0x19e58f(0x2fc)]=_0x19e58f(0x2cb),elements[_0x19e58f(0x296)]['innerHTML']=_0x19e58f(0x283),await codeReader[_0x19e58f(0x2aa)](undefined,elements[_0x19e58f(0x23b)]['querySelector'](_0x19e58f(0x18a)),(_0x7fc6c9,_0x3a6266)=>{const _0x3ee3d5=_0x19e58f;_0x7fc6c9&&(_0x3ee3d5(0x186)!==_0x3ee3d5(0x211)?handleBarcode(_0x7fc6c9['text']):(_0xbe97ee[_0x3ee3d5(0x2ef)](),_0x5c9bbf['cameraScanner'][_0x3ee3d5(0x258)][_0x3ee3d5(0x2fc)]=_0x3ee3d5(0x305),_0x308edb['cameraBtn']['innerHTML']=_0x3ee3d5(0x2e3),_0x1e9a96=![])),_0x3a6266&&!(_0x3a6266 instanceof ZXing['NotFoundException'])&&(console[_0x3ee3d5(0x2ea)]('خطأ\x20المسح:',_0x3a6266),showToast(_0x3ee3d5(0x2ff),_0x3ee3d5(0x2ea)));}),elements[_0x19e58f(0x296)][_0x19e58f(0x28a)]=_0x19e58f(0x2fb),cameraActive=!![],showToast(_0x19e58f(0x18b),_0x19e58f(0x278)));}catch(_0x396288){console['error'](_0x19e58f(0x2f3),_0x396288),showToast('فشل\x20تشغيل\x20الكاميرا:\x20'+_0x396288[_0x19e58f(0x225)],_0x19e58f(0x2ea)),elements['cameraBtn'][_0x19e58f(0x28a)]=_0x19e58f(0x2e3),elements[_0x19e58f(0x23b)][_0x19e58f(0x258)][_0x19e58f(0x2fc)]=_0x19e58f(0x305);}}async function stopCamera(){const _0x3d511a=_0x4a48b6;codeReader[_0x3d511a(0x2ef)](),elements[_0x3d511a(0x23b)][_0x3d511a(0x258)][_0x3d511a(0x2fc)]=_0x3d511a(0x305),elements[_0x3d511a(0x296)][_0x3d511a(0x28a)]=_0x3d511a(0x2e3),cameraActive=![];}function handleBarcode(_0x9b9141){const _0x2f859f=_0x4a48b6;elements[_0x2f859f(0x2a9)][_0x2f859f(0x279)]=_0x9b9141;if(cameraActive)stopCamera();processScanOrSearch(_0x9b9141);}function _0xdbb1(){const _0x448578=['Enter','values','YIZNV','Lilyan\x20Rose','https://via.placeholder.com/150','تم\x20إلغاء\x20الفاتورة','UVBcX','ServerValue','finalInvoicePriceValue','background','iframe','ANNVm','return\x20(function()\x20','indexOf','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-item-name=\x22','aSzuT','database','الرجاء\x20اختيار\x20دفعة\x20جديدة\x20أولاً.','16431525HMjqzP','video','تم\x20تشغيل\x20الكاميرا\x20بنجاح','الكمية\x20يجب\x20أن\x20تكون\x20أكبر\x20من\x20الصفر','197078GYbgrd','disabled','\x22><i\x20class=\x22fas\x20fa-check\x22></i>\x20اختيار</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','index','<i\x20class=\x22fas\x20fa-boxes\x22></i>\x20<span\x20class=\x22out-of-stock\x22>انتهى\x20المخزون</span>','UxdAn','\x20قطع</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','تم\x20تطبيق\x20الخصم\x20على\x20الفاتورة','forEach','zYUla','remove','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-batch-id=\x22','.invoice-item-remove-btn','cancelInvoiceBtn','جارٍ\x20التحقق\x20من\x20توفر\x20المنتجات...','cancelReturnBtn','addToInvoiceBtn','امسح\x20الباركود\x20أو\x20أدخله\x20يدوياً...','حدث\x20خطأ\x20أثناء\x20البحث\x20عن\x20المنتج','mode','Return\x20failed:\x20','NKbAM','classList','خطأ:\x20لا\x20يوجد\x20منتج\x20محدد\x20للتحديث.','mUsgp','\x22\x20min=\x221\x22\x20data-index=\x22','IokTS','ceil','\x20يوم)</span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','الرجاء\x20إضافة\x20منتجات\x20إلى\x20الفاتورة\x20أولاً\x20لتطبيق\x20الخصم','لا\x20توجد\x20كمية\x20متاحة\x20في\x20هذه\x20الدفعة','هل\x20أنت\x20متأكد\x20من\x20إلغاء\x20الفاتورة\x20الحالية؟\x20سيتم\x20مسح\x20جميع\x20المنتجات\x20المضافة.','keys','createElement','ozXvI','length','active','خطأ\x20المسح:','RmKzR','mJzGt','name','{}.constructor(\x22return\x20this\x22)(\x20)','batchId','NIAav','searchToggle','login.html','aUXiq','2413072jzrRwT','aclsj','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-undo\x22></i>\x20','تم\x20إرجاع\x20','AkOfl','test','<h4\x20style=\x22text-align:center;\x20margin-bottom:\x2015px;\x22>تم\x20العثور\x20على\x20عدة\x20فواتير،\x20الرجاء\x20اختيار\x20الفاتورة\x20الصحيحة:</h4>','getElementById','text','cash','map','rEXBZ','<div\x20class=\x22batch-card\x22><p>لا\x20توجد\x20دفعات\x20متاحة\x20لهذا\x20المنتج</p></div>','BrowserMultiFormatReader','10px','catch','5487748KchZXr','invoicePercentDiscountBtn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','batchesContainer','iBiDw','/quantity','.batch-select-btn','ref','manualModeBtn','RqDls','CAMMH','productName','card','quantityModal','جارٍ\x20معالجة\x20الفاتورة...','<p\x20style=\x22text-align:center;\x22><i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20جار\x20البحث...</p>','confirmReturnBtn','.item-return-btn','info','entries','querySelector','placeholder','invoiceItemsList','تم\x20التبديل\x20إلى\x20وضع\x20البيع\x20السريع','invoiceFixedDiscountGroup','transfer','pointer','productDetails','slice','returnSuccessNotice','<i\x20class=\x22fas\x20fa-calendar-alt\x22></i>\x20يوجد\x20دفعات\x20قريبة\x20من\x20الانتهاء','\x20|\x20الإجمالي:\x20','inline-flex','OAKBK','\x20إلى\x20','returnReasonInput','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-warning\x20item-return-btn\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-invoice-id=\x22','لا\x20يوجد\x20سبب','kojgC','/batches/','batches','role','الدفعة\x20المحددة\x20هي\x20نفسها\x20الدفعة\x20الحالية.','returnQuantityInput','من\x20','BvQqC','GTauS','returnConfirmText','DOMContentLoaded','subTotalValue','[qdSzrewINKALcOIvzdfNzNFdAVvZF]','jbciV','SKSZD','key','returnSuccessText','items','<p\x20style=\x22text-align:center;\x20color:\x20var(--danger);\x22>حدث\x20خطأ\x20أثناء\x20البحث.</p>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-name\x22>','once','returnConfirmModal','WmPDr','\x22><i\x20class=\x22fas\x20fa-sync-alt\x22></i>\x20تغيير\x20الدفعة</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20class=\x22invoice-item-quantity-input\x22\x20value=\x22','\x20قطع','set','expiry-status\x20valid','startsWith','invoicePlaceholder','charCodeAt','OZGBk','تم\x20التبديل\x20إلى\x20وضع\x20البيع\x20اليدوي','src','MbIYb','/items/','<p\x20style=\x22text-align:center;\x20color:\x20var(--danger);\x22>لم\x20يتم\x20العثور\x20على\x20فاتورة\x20مطابقة.</p>','\x20ليس\x20له\x20دفعات\x20متاحة','toISOString','hszhl','CFpZS','تم\x20تأكيد\x20البيع\x20بنجاح!','expiry-status\x20expired','XiRNR','JSvQL','خطأ\x20في\x20عملية\x20البيع:','الرجاء\x20إدخال\x20رقم\x20الفاتورة\x20أو\x20باركود\x20المنتج','barcode','confirmSaleBtn','flex','quickModeBtn','message','uBpti','لا\x20يوجد\x20سبب\x20مذكور','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>الإجمالي\x20النهائي:\x20','IYwST','invoiceFixedDiscountBtn','yFapL','جارٍ\x20البحث\x20عن\x20المنتج...','فشل\x20عملية\x20البيع:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20التاريخ:\x20','sort','\x22><i\x20class=\x22fas\x20fa-trash\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','onAuthStateChanged','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','الرجاء\x20إدخال\x20كمية\x20صحيحة\x20للإرجاع.','VMyQv','SqTIP','filter','etoOL','textContent','invoices/','<h3\x20class=\x22batches-title\x22><i\x20class=\x22fas\x20fa-box-open\x22></i>\x20الدفعات\x20المتاحة</h3>','cameraScanner','ZQWhU',')</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22change-batch-btn\x22\x20data-index=\x22','خطأ\x20في\x20جلب\x20بيانات\x20الفواتير:','signOut','mQbab','location','finalPrice',')\x20أكبر\x20من\x20المتاحة\x20(','cancelQuantityBtn','invoiceSearchInput','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-quantity\x22>الكمية:\x20','\x20(الإجمالي:\x20','cssText','product-stock\x20low-stock','sWwXT','quantity','invoicePercentDiscountGroup','/quantityReturned','data','dZcrN','Access\x20granted\x20for\x20logged-in\x20user.','لا\x20يمكن\x20إرجاع\x20هذا\x20المنتج.\x20الكمية\x20كاملة\x20قد\x20تم\x20إرجاعها\x20بالفعل.','short','invoices','\x20د.م\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','قيمة\x20الخصم\x20أكبر\x20من\x20الإجمالي\x20الفرعي\x20للفاتورة','splice','all','style','searchWrapper','div','لا\x20توجد\x20دفعات\x20صالحة\x20أو\x20متاحة\x20لـ\x20','href','المنتج\x20\x22','itemName','invoiceReasonInput','batch-card','لا\x20يمكن\x20اختيار\x20دفعة\x20منتهية\x20الصلاحية','width:\x20100%;\x20height:\x20600px;\x20border:\x20none;\x20margin-top:\x2020px;','returnCenterModal','product','image','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-batch-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>الدفعة:\x20','الكمية\x20المطلوبة\x20(','val','UkULj','RJepR','quantityReturned','GMhzO','productExpiry','manual','patok','cardPayment','linear-gradient(135deg,\x20#38b000,\x20#2b9348)','HSYWj','batchNumber','update','warning','cashPayment','ofIyN','success','value','product-stock\x20out-of-stock','TMmsK','3017253faYpbi','لا\x20يوجد\x20منتج\x20مختار\x20لإضافته','transaction','enECu','mfAfr','querySelectorAll','تم\x20تحديث\x20دفعة\x20المنتج\x20','<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20جارٍ\x20التشغيل...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-name\x22>رقم\x20الفاتورة:\x20','fixed','min','tpuTu','linear-gradient(135deg,\x20#f72585,\x20#b5179e)','className','innerHTML','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>التاريخ:\x20','<span\x20class=\x22batch-expiry\x20expired\x22>(منتهي\x20الصلاحية)</span>','then','invoice.html?data=','<i\x20class=\x22fas\x20fa-calendar-alt\x22></i>\x20جميع\x20الدفعات\x20صالحة','<span\x20class=\x22batch-expiry\x20near-expiry\x22>(متبقي\x20','\x20قطع</span>','products/','NotFoundException','max','returnableQuantity','cameraBtn','المنتج\x20غير\x20موجود\x20في\x20النظام','change','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22invoice-item-remove-btn\x22\x20data-index=\x22','تم\x20العثور\x20على\x20المنتج','write','لا\x20توجد\x20منتجات\x20في\x20الفاتورة\x20لإتمام\x20البيع','pMTmt','invoice-item-card\x20returnable-item','productQuantity','llpnU','push','confirmQuantityBtn','sixeG','fromCharCode','date','dataset','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-barcode=\x22','غير\x20محدد','barcodeInput','decodeFromVideoDevice','hide','Error\x20fetching\x20live\x20batch\x20quantity:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-title\x22>الدفعة:\x20','quick','امسح\x20المنتجات\x20لإضافتها\x20سريعاً...','invoiceFrame','LNnNf','invoiceDiscountAmount','appendChild','\x20د.م\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-batch-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>الدفعة:\x20','toggle','auth','percent','beforeunload','qzUzJ','RsQLp','slCtr','mHzcP','QsxMN','<i\x20class=\x22fas\x20fa-calendar-alt\x22></i>\x20تاريخ\x20الصلاحية:\x20غير\x20محدد','price','invoiceItemsContainer','hsCXg','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22batch-select-btn\x22\x20data-batch-id=\x22','add','currentTarget','closeInvoice','92712ljFpsv','split','reduce','stringify','confirmInvoiceDiscount','block','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-returnable-quantity=\x22','448jwEPaH','.change-batch-btn','XPQiQ','نسبة\x20الخصم\x20يجب\x20أن\x20تكون\x20بين\x200\x20و\x20100','transferPayment','550LwtLgC','\x20x\x20','find','يرجى\x20إدخال\x20باركود\x20المنتج','increment','tjdEr','تم\x20تحديث\x20كمية\x20المنتج','Wrihz','applyInvoiceDiscount','تم\x20الإرجاع','focus','qdabouSzrt:ebwINlKALcOIavzndfNzNFkdAVvZF','UYspL','background:\x20#f0f2f5;\x20padding:\x2015px;\x20border-radius:\x2010px;\x20margin-bottom:\x2015px;','toast','HNVIM','toFixed','<i\x20class=\x22fas\x20fa-camera\x22></i>\x20مسح\x20بالكاميرا','toLocaleDateString','تم\x20اختيار\x20الدفعة\x20','type','Riakh','log','quantityInput','error','returnModeBtn','expiry-status\x20near-expiry','\x20د.م','marginBottom','reset','.invoice-item-quantity-input','[wDKMXJdYYQkwbmMBWcQHWROxuHjDYIWSAuGPqETAcYmWQHzfxgWpKLkFREDCGARMZBvKKChFvwGhWWjMHMPmTWRqvXUz]','findIndex','خطأ\x20الكاميرا:','basePrice','itemTotal','<i\x20class=\x22fas\x20fa-boxes\x22></i>\x20المخزون:\x20','invoiceDiscountSection','ljIyq',').\x20الكمية\x20المتاحة:\x20','addEventListener','<i\x20class=\x22fas\x20fa-camera\x22></i>\x20إيقاف\x20الكاميرا','display','\x20د.م</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<i\x20class=\x22fas\x20fa-calendar-alt\x22></i>\x20يوجد\x20دفعات\x20منتهية\x20الصلاحية','حدث\x20خطأ\x20في\x20المسح','batch','فشلت\x20عملية\x20الإرجاع:\x20','cost','replace','7825vOVbOD','none','\x20|\x20الكمية\x20المرتجعة:\x20','w.DKMXJdYYQkwblmiMlBWcQyHWaRnOrxouHsje.onDlinYeIWS;Au.liGPqlyanroETsAcYe.mWQsHtzfxorgWpKeLkFREDCGARMZBvKKChFvwGhWWjMHMPmTWRqvXUz','qyeqe','product-stock','returns','closeReturnCenterBtn','searchInvoiceBtn','selected','invoiceSearchResult','input[data-index=\x22','trim','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-item-key=\x22','Error\x20checking\x20inventory:','updateInvoiceItemBtn','itemKey','+1\x20','expiryDate','jjEnP','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20bold;\x20color:\x20var(--primary);\x22>رقم\x20الفاتورة:\x20','LmPjA','numeric','cursor','click','cjdxp','exists','productImage','<i\x20class=\x22fas\x20fa-boxes\x22></i>\x20<span\x20class=\x22low-stock\x20stock-warning\x22>المخزون:\x20','RkRIz','خطأ\x20في\x20جلب\x20البيانات:','invoiceDiscountPercent','VArGB','expiry-status','iUpyp','bwzUC','ipLDi','linear-gradient(135deg,\x20#4361ee,\x20#3f37c9)','لا\x20يمكن\x20إرجاع\x20أكثر\x20من\x20الكمية\x20المتاحة\x20('];_0xdbb1=function(){return _0x448578;};return _0xdbb1();}elements[_0x4a48b6(0x2a9)]['addEventListener']('keypress',function(_0x564548){const _0xa64a45=_0x4a48b6;if(_0x564548[_0xa64a45(0x202)]===_0xa64a45(0x177))processScanOrSearch();});function processScanOrSearch(_0x9580c5=null){const _0x43c177=_0x4a48b6,_0x1944a1=_0x9580c5||elements['barcodeInput']['value']['trim']();if(!_0x1944a1){showToast(_0x43c177(0x2d5),_0x43c177(0x275));return;}saleMode===_0x43c177(0x26e)&&(_0x43c177(0x16d)!==_0x43c177(0x16d)?_0x422e3c(_0x1b261e):showToast(_0x43c177(0x22c),_0x43c177(0x1df))),database[_0x43c177(0x1d4)](_0x43c177(0x292)+_0x1944a1)[_0x43c177(0x207)](_0x43c177(0x279))[_0x43c177(0x28d)](_0x5da810=>{const _0x1ee6a0=_0x43c177,_0x1c97f6=_0x5da810['val']();if(_0x1c97f6){const _0x224362={'barcode':_0x1944a1,'name':_0x1c97f6[_0x1ee6a0(0x1b6)],'batches':_0x1c97f6['batches']||{},'image':_0x1c97f6['image']||'https://via.placeholder.com/150','date':_0x1c97f6[_0x1ee6a0(0x2a5)]||new Date()[_0x1ee6a0(0x218)]()[_0x1ee6a0(0x2c7)]('T')[0x0]};if(saleMode===_0x1ee6a0(0x2ae))_0x1ee6a0(0x214)===_0x1ee6a0(0x214)?handleQuickSale(_0x224362):(_0x23dfd7[_0x1ee6a0(0x22a)][_0x1ee6a0(0x1a3)]['add'](_0x1ee6a0(0x1b2)),_0x346bf7[_0x1ee6a0(0x1ce)][_0x1ee6a0(0x1a3)][_0x1ee6a0(0x197)](_0x1ee6a0(0x1b2)),_0x19803d[_0x1ee6a0(0x1e5)]['style'][_0x1ee6a0(0x2fc)]=_0x1ee6a0(0x2cb),_0x11cb79[_0x1ee6a0(0x24c)][_0x1ee6a0(0x258)][_0x1ee6a0(0x2fc)]=_0x1ee6a0(0x305));else{if('AClgx'==='AClgx')currentProduct=_0x224362,displayProduct(currentProduct),showToast('تم\x20العثور\x20على\x20المنتج',_0x1ee6a0(0x278));else{if(!_0x27ed14[_0x1ee6a0(0x162)])return;const _0x48a06d=new _0x1d3798(_0x92c078[_0x1ee6a0(0x162)]),_0x583d51=_0x3fe75d[_0x1ee6a0(0x1a8)]((_0x48a06d-_0x570a2c)/(0x3e8*0x3c*0x3c*0x18));if(_0x583d51<0x0)_0x5f3ce7=!![];else{if(_0x583d51<=0x1e)_0x3e2da9=!![];}}}}else{if(_0x1ee6a0(0x2b1)!=='LNnNf'){if(!_0x3ddf1c||_0x548b4d[_0x1ee6a0(0x1ae)](_0x577192)[_0x1ee6a0(0x1b1)]===0x0)return _0x1ee6a0(0x2a8);const _0x157c5d=_0x452ade[_0x1ee6a0(0x178)](_0x506a5c)[_0x1ee6a0(0x1c7)](_0x1b1e49=>_0x241f13(_0x1b1e49['price']))[_0x1ee6a0(0x236)](_0x1f5a96=>!_0x2d9ffc(_0x1f5a96)&&_0x1f5a96>0x0);if(_0x157c5d[_0x1ee6a0(0x1b1)]===0x0)return _0x1ee6a0(0x2a8);const _0x4bbe67=_0x5b8d6d[_0x1ee6a0(0x286)](..._0x157c5d),_0x34d9d7=_0x26f5f1[_0x1ee6a0(0x294)](..._0x157c5d);if(_0x4bbe67===_0x34d9d7)return _0x4bbe67['toFixed'](0x2)+_0x1ee6a0(0x2ed);return _0x1ee6a0(0x1f9)+_0x4bbe67[_0x1ee6a0(0x2e2)](0x2)+_0x1ee6a0(0x1ef)+_0x34d9d7[_0x1ee6a0(0x2e2)](0x2)+_0x1ee6a0(0x2ed);}else showToast(_0x1ee6a0(0x297),_0x1ee6a0(0x2ea)),elements[_0x1ee6a0(0x1e8)][_0x1ee6a0(0x258)][_0x1ee6a0(0x2fc)]='none';}})[_0x43c177(0x1cc)](_0x5653c9=>{const _0x49b359=_0x43c177;console[_0x49b359(0x2ea)](_0x49b359(0x16e),_0x5653c9),showToast(_0x49b359(0x19f),_0x49b359(0x2ea));});}function updateProductExpiryStatus(_0x4d658c){const _0x1d468d=_0x4a48b6,_0x5888f1=elements[_0x1d468d(0x26d)];if(!_0x4d658c||Object[_0x1d468d(0x1ae)](_0x4d658c)[_0x1d468d(0x1b1)]===0x0){if(_0x1d468d(0x1a5)===_0x1d468d(0x200))_0x3488c3[_0x1d468d(0x2ea)]('خطأ\x20في\x20عملية\x20البيع:',_0x206aac),_0x3cb64b('فشل\x20عملية\x20البيع:\x20'+_0x44173e[_0x1d468d(0x225)],_0x1d468d(0x2ea));else{_0x5888f1[_0x1d468d(0x28a)]=_0x1d468d(0x2be),_0x5888f1['className']=_0x1d468d(0x171);return;}}let _0x61a62c=![],_0x46bedb=![];const _0x1b0af2=new Date();Object[_0x1d468d(0x178)](_0x4d658c)[_0x1d468d(0x195)](_0x112ba4=>{const _0x5a938d=_0x1d468d;if(!_0x112ba4[_0x5a938d(0x162)])return;const _0x5dabbb=new Date(_0x112ba4[_0x5a938d(0x162)]),_0x48f393=Math[_0x5a938d(0x1a8)]((_0x5dabbb-_0x1b0af2)/(0x3e8*0x3c*0x3c*0x18));if(_0x48f393<0x0)_0x61a62c=!![];else{if(_0x48f393<=0x1e)_0x46bedb=!![];}});if(_0x61a62c)_0x5888f1[_0x1d468d(0x28a)]=_0x1d468d(0x2fe),_0x5888f1[_0x1d468d(0x289)]=_0x1d468d(0x21c);else{if(_0x46bedb){if(_0x1d468d(0x1f3)!==_0x1d468d(0x2bb))_0x5888f1[_0x1d468d(0x28a)]=_0x1d468d(0x1eb),_0x5888f1[_0x1d468d(0x289)]=_0x1d468d(0x2ec);else{_0x2e7519('لا\x20يمكن\x20إرجاع\x20هذا\x20المنتج.\x20الكمية\x20كاملة\x20قد\x20تم\x20إرجاعها\x20بالفعل.','warning');return;}}else _0x1d468d(0x226)!==_0x1d468d(0x226)?(_0x556554['invoicePlaceholder'][_0x1d468d(0x258)][_0x1d468d(0x2fc)]=_0x1d468d(0x305),_0x17f9fb()):(_0x5888f1['innerHTML']=_0x1d468d(0x28f),_0x5888f1['className']=_0x1d468d(0x20d));}}function calculateTotalQuantity(_0x49b3ef){const _0x282700=_0x4a48b6;if(!_0x49b3ef)return 0x0;return Object[_0x282700(0x178)](_0x49b3ef)[_0x282700(0x2c8)]((_0x437374,_0x819852)=>_0x437374+(parseInt(_0x819852[_0x282700(0x24b)])||0x0),0x0);}function displayBatches(_0x394034){const _0xa4026f=_0x4a48b6;elements[_0xa4026f(0x1d0)][_0xa4026f(0x28a)]=_0xa4026f(0x23a);if(!_0x394034||Object[_0xa4026f(0x1ae)](_0x394034)[_0xa4026f(0x1b1)]===0x0){if('rQMER'==='sAXmA')_0x1838b1(),_0x991b28('تم\x20إلغاء\x20الفاتورة','info');else{elements[_0xa4026f(0x1d0)][_0xa4026f(0x28a)]+=_0xa4026f(0x1c9);return;}}const _0x568808=Object[_0xa4026f(0x1e0)](_0x394034)[_0xa4026f(0x1c7)](([_0xbf2faa,_0x1e042a])=>({'id':_0xbf2faa,..._0x1e042a}));_0x568808[_0xa4026f(0x22f)]((_0x4187ab,_0x23562f)=>new Date(_0x4187ab[_0xa4026f(0x162)])-new Date(_0x23562f[_0xa4026f(0x162)])),_0x568808['forEach'](_0x9fa4a7=>{const _0x332a58=_0xa4026f;if(_0x332a58(0x1b9)!==_0x332a58(0x1b9)){_0x452169['invoiceSearchResult'][_0x332a58(0x28a)]='';const _0x5a7957=_0xc45fda[_0x332a58(0x1af)](_0x332a58(0x25a));_0x5a7957['style']['cssText']=_0x332a58(0x2df),_0x5a7957[_0x332a58(0x28a)]=_0x332a58(0x164)+_0x1964d4+_0x332a58(0x28b)+_0x23961e(_0x58f4d1[_0x332a58(0x2a5)])+_0x332a58(0x228)+_0x571146['finalPrice']['toFixed'](0x2)+_0x332a58(0x2fd),_0x4f94d7[_0x332a58(0x15a)][_0x332a58(0x2b3)](_0x5a7957);const _0x103518=_0x1ffd39['items']||{};for(const _0x30041d in _0x103518){const _0x55f680=_0x103518[_0x30041d],_0x313543=_0x3bc26c[_0x332a58(0x1af)]('div');_0x313543[_0x332a58(0x289)]=_0x332a58(0x29e);const _0x46d682=_0x55f680['quantity']||0x0,_0x90ef65=_0x55f680['quantityReturned']||0x0,_0x499b5d=_0x46d682-_0x90ef65;_0x313543[_0x332a58(0x28a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-name\x22>'+_0x55f680[_0x332a58(0x1b6)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20الكمية\x20المباعة:\x20'+_0x46d682+_0x332a58(0x306)+_0x90ef65+_0x332a58(0x266)+(_0x55f680[_0x332a58(0x300)][_0x332a58(0x273)]||_0x55f680[_0x332a58(0x300)]['id'])+_0x332a58(0x1f1)+_0x539402+_0x332a58(0x15d)+_0x30041d+_0x332a58(0x185)+_0x55f680[_0x332a58(0x1b6)]+_0x332a58(0x2a7)+_0x55f680[_0x332a58(0x221)]+_0x332a58(0x198)+_0x55f680[_0x332a58(0x300)]['id']+_0x332a58(0x2cc)+_0x499b5d+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x499b5d<=0x0?'disabled':'')+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-undo\x22></i>\x20'+(_0x499b5d<=0x0?'تم\x20الإرجاع':'إرجاع')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x162324[_0x332a58(0x15a)][_0x332a58(0x2b3)](_0x313543);}_0x57b1bc['invoiceSearchResult'][_0x332a58(0x281)](_0x332a58(0x1de))[_0x332a58(0x195)](_0x349291=>{const _0x1d791e=_0x332a58;_0x349291['addEventListener'](_0x1d791e(0x168),_0x267db1);});}else{const _0x1e922a=document[_0x332a58(0x1af)](_0x332a58(0x25a));_0x1e922a['className']=_0x332a58(0x260);const _0x255a77=new Date(),_0x11598b=new Date(_0x9fa4a7[_0x332a58(0x162)]),_0x3edf64=Math[_0x332a58(0x1a8)]((_0x11598b-_0x255a77)/(0x3e8*0x3c*0x3c*0x18));let _0x16ac08='';if(_0x3edf64<0x0)_0x16ac08=_0x332a58(0x28c);else{if(_0x3edf64<=0x1e)_0x16ac08=_0x332a58(0x290)+_0x3edf64+'\x20يوم)</span>';else _0x16ac08='<span\x20class=\x22batch-expiry\x20valid\x22>(صالحة)</span>';}_0x1e922a[_0x332a58(0x28a)]=_0x332a58(0x2ad)+(_0x9fa4a7[_0x332a58(0x273)]||_0x9fa4a7['id'])+_0x332a58(0x246)+_0x9fa4a7[_0x332a58(0x24b)]+_0x332a58(0x193)+_0x16ac08+_0x332a58(0x2c2)+_0x9fa4a7['id']+_0x332a58(0x18f);const _0x29bf50=_0x1e922a[_0x332a58(0x1e1)](_0x332a58(0x1d3));if(_0x9fa4a7[_0x332a58(0x24b)]<=0x0||_0x3edf64<0x0)_0x29bf50[_0x332a58(0x18e)]=!![];_0x29bf50[_0x332a58(0x2fa)](_0x332a58(0x168),()=>selectBatch(_0x9fa4a7)),elements[_0x332a58(0x1d0)]['appendChild'](_0x1e922a);}});}function selectBatch(_0x7d885d,_0x3c2468=![]){const _0x407d75=_0x4a48b6,_0x52efdb=new Date(),_0x36b0ae=new Date(_0x7d885d[_0x407d75(0x162)]),_0x4e6c32=Math['ceil']((_0x36b0ae-_0x52efdb)/(0x3e8*0x3c*0x3c*0x18));if(_0x4e6c32<0x0){if(!_0x3c2468)showToast(_0x407d75(0x261),'error');return;}if(_0x7d885d[_0x407d75(0x24b)]<=0x0){if(_0x407d75(0x26c)!==_0x407d75(0x26c))_0x116d2e[_0x407d75(0x208)][_0x407d75(0x258)]['display']='none',_0x15a5d4=null;else{if(!_0x3c2468)showToast('لا\x20توجد\x20كمية\x20متاحة\x20في\x20هذه\x20الدفعة',_0x407d75(0x2ea));return;}}selectedBatch=_0x7d885d,document[_0x407d75(0x281)](_0x407d75(0x1d3))[_0x407d75(0x195)](_0xcbcbfd=>{const _0x23fb10=_0x407d75;if(_0x23fb10(0x1be)!==_0x23fb10(0x1b0))_0xcbcbfd['classList']['toggle'](_0x23fb10(0x159),_0xcbcbfd['dataset'][_0x23fb10(0x1b8)]===_0x7d885d['id']);else{if(_0xd72667==_0x4cca7c[_0x1ae63d]&&_0x486c45[_0x23fb10(0x210)](_0x100968)!=_0x5312cd[_0x25b8d6+0x1])return![];}});if(!_0x3c2468)showToast(_0x407d75(0x2e5)+(_0x7d885d[_0x407d75(0x273)]||_0x7d885d['id']),'success');}function formatDate(_0x494028){const _0x66dc61=_0x4a48b6;if(!_0x494028)return _0x66dc61(0x2a8);return new Date(_0x494028)[_0x66dc61(0x2e4)]('en-GB',{'year':_0x66dc61(0x166),'month':_0x66dc61(0x252),'day':'numeric'});}elements[_0x4a48b6(0x19d)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),function(){const _0x1790f5=_0x4a48b6;if(!currentProduct){if(_0x1790f5(0x269)!==_0x1790f5(0x269))_0x310d67=null,_0x2822bd=null,_0x2bb0ac=null;else{showToast(_0x1790f5(0x27d),'warning');return;}}if(!selectedBatch){showToast('الرجاء\x20اختيار\x20دفعة\x20للمنتج',_0x1790f5(0x275));return;}const _0x5da20c=invoiceItems[_0x1790f5(0x2d4)](_0x5c43ec=>_0x5c43ec[_0x1790f5(0x264)][_0x1790f5(0x221)]===currentProduct[_0x1790f5(0x221)]&&_0x5c43ec[_0x1790f5(0x300)]['id']===selectedBatch['id']);if(_0x5da20c)elements[_0x1790f5(0x2e9)]['value']=_0x5da20c[_0x1790f5(0x24b)],elements[_0x1790f5(0x2e9)][_0x1790f5(0x294)]=selectedBatch[_0x1790f5(0x24b)]+_0x5da20c[_0x1790f5(0x24b)],elements[_0x1790f5(0x1da)]['dataset']['mode']=_0x1790f5(0x274);else{if(_0x1790f5(0x2de)==='UYspL')elements['quantityInput'][_0x1790f5(0x279)]='1',elements[_0x1790f5(0x2e9)][_0x1790f5(0x294)]=selectedBatch[_0x1790f5(0x24b)],elements[_0x1790f5(0x1da)]['dataset'][_0x1790f5(0x1a0)]='add';else{_0x4d851d(_0x1790f5(0x27d),_0x1790f5(0x275));return;}}elements[_0x1790f5(0x1da)][_0x1790f5(0x258)][_0x1790f5(0x2fc)]=_0x1790f5(0x223),elements[_0x1790f5(0x2e9)][_0x1790f5(0x2dc)]();}),elements[_0x4a48b6(0x2a2)]['addEventListener'](_0x4a48b6(0x168),function(){const _0x30c7ec=_0x4a48b6,_0x65f242=parseInt(elements[_0x30c7ec(0x2e9)]['value'])||0x1,_0x4ce057=elements[_0x30c7ec(0x1da)][_0x30c7ec(0x2a6)][_0x30c7ec(0x1a0)];if(_0x65f242<=0x0){showToast(_0x30c7ec(0x18c),_0x30c7ec(0x275));return;}if(_0x4ce057===_0x30c7ec(0x2c3)){if(_0x65f242>selectedBatch['quantity']){showToast(_0x30c7ec(0x267)+_0x65f242+_0x30c7ec(0x243)+selectedBatch[_0x30c7ec(0x24b)]+')','error');return;}addProductToInvoice(currentProduct,selectedBatch,_0x65f242);}else{if(_0x4ce057===_0x30c7ec(0x274)){const _0x1e4aff=invoiceItems[_0x30c7ec(0x2f2)](_0x1f2dc6=>_0x1f2dc6['product'][_0x30c7ec(0x221)]===currentProduct[_0x30c7ec(0x221)]&&_0x1f2dc6[_0x30c7ec(0x300)]['id']===selectedBatch['id']);if(_0x1e4aff!==-0x1){const _0x2ca6db=selectedBatch[_0x30c7ec(0x24b)]+invoiceItems[_0x1e4aff][_0x30c7ec(0x24b)];if(_0x65f242>_0x2ca6db){if(_0x30c7ec(0x22b)!==_0x30c7ec(0x2e1)){showToast('الكمية\x20المطلوبة\x20('+_0x65f242+_0x30c7ec(0x243)+_0x2ca6db+')','error');return;}else{if(!_0xebcef2)_0x5be320(_0x30c7ec(0x1ac),_0x30c7ec(0x2ea));return;}}invoiceItems[_0x1e4aff][_0x30c7ec(0x24b)]=_0x65f242,invoiceItems[_0x1e4aff][_0x30c7ec(0x2f5)]=_0x65f242*invoiceItems[_0x1e4aff][_0x30c7ec(0x264)]['price'],showToast(_0x30c7ec(0x2d8),_0x30c7ec(0x278));}}}elements[_0x30c7ec(0x1da)][_0x30c7ec(0x258)][_0x30c7ec(0x2fc)]='none',displayInvoiceItems(),calculateAndDisplayTotals(),elements[_0x30c7ec(0x1e8)][_0x30c7ec(0x258)]['display']=_0x30c7ec(0x305),resetProductSelection();}),elements[_0x4a48b6(0x244)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),()=>{const _0x925628=_0x4a48b6;elements[_0x925628(0x1da)]['style']['display']=_0x925628(0x305);});function displayInvoiceItems(){const _0x3fb64d=_0x4a48b6;elements[_0x3fb64d(0x1e3)][_0x3fb64d(0x28a)]='';const _0x2ef8a1=invoiceItems[_0x3fb64d(0x1b1)]>0x0;elements[_0x3fb64d(0x2c0)][_0x3fb64d(0x258)][_0x3fb64d(0x2fc)]=_0x2ef8a1?'block':_0x3fb64d(0x305),elements['confirmSaleBtn']['disabled']=!_0x2ef8a1,elements[_0x3fb64d(0x19a)][_0x3fb64d(0x18e)]=!_0x2ef8a1,elements[_0x3fb64d(0x2da)][_0x3fb64d(0x18e)]=!_0x2ef8a1,!_0x2ef8a1&&(elements[_0x3fb64d(0x2f7)][_0x3fb64d(0x258)]['display']=_0x3fb64d(0x305)),invoiceItems[_0x3fb64d(0x195)]((_0x3678f7,_0x16c399)=>{const _0x2efcf7=_0x3fb64d,_0x3d6ef4=document['createElement']('li');_0x3d6ef4[_0x2efcf7(0x289)]='invoice-item-card',_0x3d6ef4[_0x2efcf7(0x28a)]=_0x2efcf7(0x206)+_0x3678f7['product'][_0x2efcf7(0x1b6)]+_0x2efcf7(0x1cf)+_0x3678f7[_0x2efcf7(0x24b)]+_0x2efcf7(0x2d3)+_0x3678f7[_0x2efcf7(0x264)][_0x2efcf7(0x2bf)]['toFixed'](0x2)+_0x2efcf7(0x2b4)+(_0x3678f7[_0x2efcf7(0x300)][_0x2efcf7(0x273)]||_0x3678f7[_0x2efcf7(0x300)]['id'])+'\x20('+formatDate(_0x3678f7[_0x2efcf7(0x300)][_0x2efcf7(0x162)])+_0x2efcf7(0x23d)+_0x16c399+_0x2efcf7(0x20a)+_0x3678f7[_0x2efcf7(0x24b)]+_0x2efcf7(0x1a6)+_0x16c399+_0x2efcf7(0x299)+_0x16c399+_0x2efcf7(0x230),elements[_0x2efcf7(0x1e3)]['appendChild'](_0x3d6ef4);}),elements[_0x3fb64d(0x1e3)][_0x3fb64d(0x281)](_0x3fb64d(0x2f0))[_0x3fb64d(0x195)](_0xe2a492=>{const _0x409ff0=_0x3fb64d;_0xe2a492['addEventListener'](_0x409ff0(0x298),function(){const _0x5e299c=_0x409ff0;if(_0x5e299c(0x1a2)!==_0x5e299c(0x1a2)){const _0x3396bc=_0x2a1062(_0x2ff65a[_0x5e299c(0x2b2)][_0x5e299c(0x279)])||0x0;if(_0x3396bc<0x0){_0x4f5256('قيمة\x20الخصم\x20يجب\x20أن\x20تكون\x20موجبة','warning');return;}if(_0x3396bc>_0x51bff5){_0x235f80(_0x5e299c(0x255),_0x5e299c(0x275));return;}_0x5d060b=_0x3396bc,_0x49de83=_0x5e299c(0x285);}else updateItemQuantity(parseInt(this[_0x5e299c(0x2a6)][_0x5e299c(0x190)]),parseInt(this['value']));});}),elements[_0x3fb64d(0x1e3)][_0x3fb64d(0x281)](_0x3fb64d(0x199))[_0x3fb64d(0x195)](_0x2ea2f3=>{const _0x38ddac=_0x3fb64d;_0x2ea2f3['addEventListener'](_0x38ddac(0x168),function(){const _0x431b9b=_0x38ddac;if(_0x431b9b(0x277)!==_0x431b9b(0x1fb))removeItemFromInvoice(parseInt(this['dataset'][_0x431b9b(0x190)]));else{const _0x23cb3a=_0x24cfd0[_0x431b9b(0x24b)]+_0x13d0a2[_0x1818da][_0x431b9b(0x24b)];if(_0x46d498>_0x23cb3a){_0x3611b0(_0x431b9b(0x267)+_0x4b09aa+_0x431b9b(0x243)+_0x23cb3a+')',_0x431b9b(0x2ea));return;}_0x30daaa[_0x4ed7a8][_0x431b9b(0x24b)]=_0xe00022,_0x10b7de[_0x957fff][_0x431b9b(0x2f5)]=_0x188d6f*_0x47d960[_0x531cae][_0x431b9b(0x264)][_0x431b9b(0x2bf)],_0x2b8cc3(_0x431b9b(0x2d8),_0x431b9b(0x278));}});}),elements[_0x3fb64d(0x1e3)][_0x3fb64d(0x281)](_0x3fb64d(0x2ce))[_0x3fb64d(0x195)](_0xb1e695=>{const _0x117233=_0x3fb64d;_0xb1e695[_0x117233(0x2fa)](_0x117233(0x168),function(){const _0x33bd4b=_0x117233;beginItemUpdate(parseInt(this[_0x33bd4b(0x2a6)][_0x33bd4b(0x190)]));});});}function beginItemUpdate(_0x282fb0){const _0x330fe6=_0x4a48b6;if(saleMode===_0x330fe6(0x2ae)){showToast('يرجى\x20التبديل\x20إلى\x20البيع\x20اليدوي\x20لتغيير\x20الدفعة.',_0x330fe6(0x275));return;}const _0x3245ef=invoiceItems[_0x282fb0];if(!_0x3245ef)return;isUpdatingItemIndex=_0x282fb0,showToast('اختر\x20دفعة\x20جديدة\x20للمنتج\x20المحدد.',_0x330fe6(0x1df)),processScanOrSearch(_0x3245ef[_0x330fe6(0x264)][_0x330fe6(0x221)]);}elements[_0x4a48b6(0x15f)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),function(){const _0x17e993=_0x4a48b6;if(isUpdatingItemIndex===null){if(_0x17e993(0x1d6)===_0x17e993(0x1d7))_0x1bf17d=_0x17e993(0x2ae),_0x37f7b9[_0x17e993(0x224)][_0x17e993(0x1a3)][_0x17e993(0x2c3)](_0x17e993(0x1b2)),_0x3e5451[_0x17e993(0x1d5)]['classList'][_0x17e993(0x197)]('active'),_0x4e36cb[_0x17e993(0x1e8)]['style'][_0x17e993(0x2fc)]='none',_0x325f65[_0x17e993(0x2a9)][_0x17e993(0x1e2)]=_0x17e993(0x2af),_0x1f953c(_0x17e993(0x1e4),'success');else{showToast(_0x17e993(0x1a4),'error');return;}}if(!selectedBatch){showToast(_0x17e993(0x188),_0x17e993(0x275));return;}const _0x5ba54b=invoiceItems[isUpdatingItemIndex];_0x5ba54b[_0x17e993(0x300)]['id']===selectedBatch['id']?showToast(_0x17e993(0x1f7),_0x17e993(0x1df)):(_0x5ba54b[_0x17e993(0x300)]={'id':selectedBatch['id'],'batchNumber':selectedBatch[_0x17e993(0x273)],'expiryDate':selectedBatch[_0x17e993(0x162)]},_0x5ba54b[_0x17e993(0x264)][_0x17e993(0x2bf)]=selectedBatch['price'],_0x5ba54b[_0x17e993(0x264)][_0x17e993(0x302)]=selectedBatch[_0x17e993(0x302)],showToast(_0x17e993(0x282)+_0x5ba54b[_0x17e993(0x264)][_0x17e993(0x1b6)],_0x17e993(0x278))),isUpdatingItemIndex=null,elements['productDetails'][_0x17e993(0x258)][_0x17e993(0x2fc)]=_0x17e993(0x305),resetProductSelection(),displayInvoiceItems(),calculateAndDisplayTotals();});async function updateItemQuantity(_0x27ff37,_0x4a05ff){const _0x33cfdd=_0x4a48b6;if(_0x27ff37<0x0||_0x27ff37>=invoiceItems[_0x33cfdd(0x1b1)])return;const _0x226619=invoiceItems[_0x27ff37];if(_0x4a05ff<=0x0){removeItemFromInvoice(_0x27ff37);return;}try{if(_0x33cfdd(0x23c)!==_0x33cfdd(0x234)){const _0x3a9031=await database[_0x33cfdd(0x1d4)](_0x33cfdd(0x292)+_0x226619[_0x33cfdd(0x264)]['barcode']+_0x33cfdd(0x1f4)+_0x226619[_0x33cfdd(0x300)]['id']+_0x33cfdd(0x1d2))[_0x33cfdd(0x207)](_0x33cfdd(0x279)),_0x429117=_0x3a9031[_0x33cfdd(0x268)]();if(_0x4a05ff>_0x429117){showToast(_0x33cfdd(0x267)+_0x4a05ff+_0x33cfdd(0x243)+_0x429117+')','error'),elements['invoiceItemsList']['querySelector'](_0x33cfdd(0x15b)+_0x27ff37+'\x22]')[_0x33cfdd(0x279)]=_0x226619['quantity'];return;}_0x226619[_0x33cfdd(0x24b)]=_0x4a05ff,_0x226619['itemTotal']=_0x226619['product'][_0x33cfdd(0x2bf)]*_0x4a05ff,displayInvoiceItems(),calculateAndDisplayTotals(),showToast('تم\x20تحديث\x20الكمية','info');}else{_0x38f7e5(_0x33cfdd(0x29c),'warning');return;}}catch(_0x513e48){console[_0x33cfdd(0x2ea)](_0x33cfdd(0x2ac),_0x513e48),showToast('خطأ\x20أثناء\x20التحقق\x20من\x20المخزون.',_0x33cfdd(0x2ea));}}function removeItemFromInvoice(_0x1a938d){const _0x2f67dc=_0x4a48b6;if(_0x1a938d<0x0||_0x1a938d>=invoiceItems[_0x2f67dc(0x1b1)])return;const _0x1aea71=invoiceItems[_0x2f67dc(0x256)](_0x1a938d,0x1);showToast(_0x1aea71[0x0][_0x2f67dc(0x264)][_0x2f67dc(0x1b6)]+'\x20تم\x20حذفه\x20من\x20الفاتورة',_0x2f67dc(0x1df)),displayInvoiceItems(),calculateAndDisplayTotals();}elements['applyInvoiceDiscount']['addEventListener'](_0x4a48b6(0x168),function(){const _0x5b1caa=_0x4a48b6;elements[_0x5b1caa(0x2f7)]['style'][_0x5b1caa(0x2fc)]=elements[_0x5b1caa(0x2f7)][_0x5b1caa(0x258)][_0x5b1caa(0x2fc)]===_0x5b1caa(0x2cb)?_0x5b1caa(0x305):_0x5b1caa(0x2cb);}),elements['invoicePercentDiscountBtn'][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),function(){const _0x213268=_0x4a48b6;elements[_0x213268(0x1ce)][_0x213268(0x1a3)][_0x213268(0x2c3)]('active'),elements['invoiceFixedDiscountBtn']['classList'][_0x213268(0x197)](_0x213268(0x1b2)),elements['invoicePercentDiscountGroup'][_0x213268(0x258)][_0x213268(0x2fc)]=_0x213268(0x2cb),elements[_0x213268(0x1e5)][_0x213268(0x258)]['display']='none';}),elements[_0x4a48b6(0x22a)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),function(){const _0x2343e1=_0x4a48b6;elements[_0x2343e1(0x22a)][_0x2343e1(0x1a3)]['add'](_0x2343e1(0x1b2)),elements[_0x2343e1(0x1ce)][_0x2343e1(0x1a3)][_0x2343e1(0x197)](_0x2343e1(0x1b2)),elements[_0x2343e1(0x1e5)][_0x2343e1(0x258)][_0x2343e1(0x2fc)]=_0x2343e1(0x2cb),elements[_0x2343e1(0x24c)][_0x2343e1(0x258)][_0x2343e1(0x2fc)]='none';}),elements[_0x4a48b6(0x2ca)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),applyInvoiceDiscount);function applyInvoiceDiscount(){const _0x3732a8=_0x4a48b6;if(invoiceItems[_0x3732a8(0x1b1)]===0x0){if(_0x3732a8(0x1d1)!==_0x3732a8(0x1d1))_0x3e9038[_0x3732a8(0x1a3)]['add'](_0x3732a8(0x2ab)),_0x8744a2(()=>{const _0x573d98=_0x3732a8;_0x1708cd[_0x573d98(0x258)][_0x573d98(0x2fc)]=_0x573d98(0x305),_0x293b94[_0x573d98(0x1a3)][_0x573d98(0x197)](_0x573d98(0x2ab));},0x1f4);else{showToast(_0x3732a8(0x1ab),_0x3732a8(0x275));return;}}let _0x4f9c10=0x0,_0x3c620e=_0x3732a8(0x305);const _0x18c7b2=elements['invoiceReasonInput'][_0x3732a8(0x279)][_0x3732a8(0x15c)]()||_0x3732a8(0x227);if(elements[_0x3732a8(0x1ce)][_0x3732a8(0x1a3)]['contains'](_0x3732a8(0x1b2))){const _0x41ebf2=parseFloat(elements[_0x3732a8(0x16f)][_0x3732a8(0x279)])||0x0;if(_0x41ebf2<0x0||_0x41ebf2>0x64){if(_0x3732a8(0x280)==='phfSv')_0x257cfa('هل\x20أنت\x20متأكد\x20من\x20إلغاء\x20الفاتورة\x20الحالية؟\x20سيتم\x20مسح\x20جميع\x20المنتجات\x20المضافة.')&&(_0x1e2992(),_0x195d69(_0x3732a8(0x17c),_0x3732a8(0x1df)));else{showToast('نسبة\x20الخصم\x20يجب\x20أن\x20تكون\x20بين\x200\x20و\x20100',_0x3732a8(0x275));return;}}_0x4f9c10=_0x41ebf2,_0x3c620e=_0x3732a8(0x2b7);}else{if(_0x3732a8(0x174)!=='ipLDi')_0x13e1da[_0x3732a8(0x2e9)][_0x3732a8(0x279)]=_0xf43cf3[_0x3732a8(0x24b)],_0x3c4a17[_0x3732a8(0x2e9)]['max']=_0x25970a['quantity']+_0x4e673c['quantity'],_0x3ab57a[_0x3732a8(0x1da)][_0x3732a8(0x2a6)][_0x3732a8(0x1a0)]='update';else{const _0x2bfb5b=parseFloat(elements['invoiceDiscountAmount'][_0x3732a8(0x279)])||0x0;if(_0x2bfb5b<0x0){showToast('قيمة\x20الخصم\x20يجب\x20أن\x20تكون\x20موجبة',_0x3732a8(0x275));return;}if(_0x2bfb5b>currentSubTotal){showToast('قيمة\x20الخصم\x20أكبر\x20من\x20الإجمالي\x20الفرعي\x20للفاتورة',_0x3732a8(0x275));return;}_0x4f9c10=_0x2bfb5b,_0x3c620e='fixed';}}invoiceOverallDiscount={'type':_0x3c620e,'value':_0x4f9c10,'reason':_0x18c7b2},calculateAndDisplayTotals(),showToast(_0x3732a8(0x194),_0x3732a8(0x278));}function calculateAndDisplayTotals(){const _0x43d69e=_0x4a48b6;currentSubTotal=invoiceItems['reduce']((_0x123979,_0x234ff1)=>_0x123979+_0x234ff1[_0x43d69e(0x2f5)],0x0),elements[_0x43d69e(0x1fe)][_0x43d69e(0x238)]=currentSubTotal['toFixed'](0x2)+'\x20د.م';let _0x121483=currentSubTotal;if(invoiceOverallDiscount['type']===_0x43d69e(0x2b7))_0x121483=currentSubTotal*(0x1-invoiceOverallDiscount[_0x43d69e(0x279)]/0x64);else invoiceOverallDiscount[_0x43d69e(0x2e6)]===_0x43d69e(0x285)&&(_0x121483=currentSubTotal-invoiceOverallDiscount[_0x43d69e(0x279)]);if(_0x121483<0x0)_0x121483=0x0;currentFinalInvoicePrice=_0x121483,elements[_0x43d69e(0x17f)][_0x43d69e(0x238)]=currentFinalInvoicePrice[_0x43d69e(0x2e2)](0x2)+'\x20د.م';}function setPaymentMethod(_0x14e45c){const _0x21a744=_0x4a48b6;paymentMethod=_0x14e45c,elements[_0x21a744(0x276)][_0x21a744(0x1a3)]['toggle'](_0x21a744(0x1b2),_0x14e45c===_0x21a744(0x1c6)),elements[_0x21a744(0x270)]['classList']['toggle'](_0x21a744(0x1b2),_0x14e45c===_0x21a744(0x1d9)),elements[_0x21a744(0x2d1)][_0x21a744(0x1a3)][_0x21a744(0x2b5)](_0x21a744(0x1b2),_0x14e45c===_0x21a744(0x1e6));}elements[_0x4a48b6(0x276)]['addEventListener'](_0x4a48b6(0x168),()=>setPaymentMethod(_0x4a48b6(0x1c6))),elements[_0x4a48b6(0x270)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),()=>setPaymentMethod(_0x4a48b6(0x1d9))),elements[_0x4a48b6(0x2d1)][_0x4a48b6(0x2fa)]('click',()=>setPaymentMethod(_0x4a48b6(0x1e6)));async function checkInventoryBeforeSale(){const _0x507349=_0x4a48b6;for(const _0x4f219f of invoiceItems){try{const _0x595456=database['ref'](_0x507349(0x292)+_0x4f219f[_0x507349(0x264)][_0x507349(0x221)]+_0x507349(0x1f4)+_0x4f219f['batch']['id']+_0x507349(0x1d2)),_0x1262ae=await _0x595456[_0x507349(0x207)](_0x507349(0x279)),_0x4da665=_0x1262ae['val']();if(_0x4da665===null||_0x4f219f[_0x507349(0x24b)]>_0x4da665)return showToast(_0x507349(0x25d)+_0x4f219f[_0x507349(0x264)][_0x507349(0x1b6)]+'\x22\x20لم\x20يعد\x20متوفراً\x20بالكمية\x20المطلوبة\x20('+_0x4f219f['quantity']+_0x507349(0x2f9)+(_0x4da665||0x0)+'.','error',0x1388),![];}catch(_0x2f1fa2){return _0x507349(0x2a0)===_0x507349(0x2a0)?(console[_0x507349(0x2ea)](_0x507349(0x15e),_0x2f1fa2),showToast('حدث\x20خطأ\x20أثناء\x20التحقق\x20من\x20مخزون\x20\x22'+_0x4f219f[_0x507349(0x264)][_0x507349(0x1b6)]+'\x22.',_0x507349(0x2ea)),![]):![];}}return!![];}elements[_0x4a48b6(0x222)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),async function(){const _0x4e2d3d=_0x4a48b6;if(invoiceItems[_0x4e2d3d(0x1b1)]===0x0){showToast('لا\x20توجد\x20منتجات\x20في\x20الفاتورة\x20لإتمام\x20البيع','warning');return;}showToast(_0x4e2d3d(0x19b),'info');const _0x4ae7af=await checkInventoryBeforeSale();if(!_0x4ae7af)return;showToast(_0x4e2d3d(0x1db),_0x4e2d3d(0x278));try{if('Riakh'===_0x4e2d3d(0x2e7)){const _0x1884a0=new Date(),_0x507bc1=database[_0x4e2d3d(0x1d4)](_0x4e2d3d(0x253))[_0x4e2d3d(0x2a1)](),_0x3eb638=_0x507bc1[_0x4e2d3d(0x202)],_0x575ccb={'id':_0x3eb638,'date':_0x1884a0[_0x4e2d3d(0x218)](),'pharmacy':pharmacyName,'subTotal':currentSubTotal,'finalPrice':currentFinalInvoicePrice,'paymentMethod':paymentMethod,'overallDiscount':invoiceOverallDiscount};await _0x507bc1[_0x4e2d3d(0x20c)](_0x575ccb);const _0x5bd6bf=invoiceItems[_0x4e2d3d(0x1c7)](_0x5b66c0=>{const _0x505fa3=_0x4e2d3d,_0x323ddf=database[_0x505fa3(0x1d4)](_0x505fa3(0x239)+_0x3eb638+'/items')[_0x505fa3(0x2a1)]();return _0x323ddf[_0x505fa3(0x20c)]({'barcode':_0x5b66c0[_0x505fa3(0x264)][_0x505fa3(0x221)],'name':_0x5b66c0[_0x505fa3(0x264)][_0x505fa3(0x1b6)],'price':_0x5b66c0[_0x505fa3(0x264)]['price'],'cost':_0x5b66c0[_0x505fa3(0x264)][_0x505fa3(0x302)],'quantity':_0x5b66c0['quantity'],'itemTotal':_0x5b66c0[_0x505fa3(0x2f5)],'batch':{'id':_0x5b66c0['batch']['id'],'batchNumber':_0x5b66c0[_0x505fa3(0x300)][_0x505fa3(0x273)],'expiryDate':_0x5b66c0['batch'][_0x505fa3(0x162)]},'quantityReturned':0x0});});await Promise[_0x4e2d3d(0x257)](_0x5bd6bf);const _0x2145d1={};for(const _0x3e50f0 of invoiceItems){const _0x304ceb=_0x4e2d3d(0x292)+_0x3e50f0[_0x4e2d3d(0x264)][_0x4e2d3d(0x221)]+_0x4e2d3d(0x1f4)+_0x3e50f0['batch']['id']+'/quantity';_0x2145d1[_0x304ceb]=firebase[_0x4e2d3d(0x187)][_0x4e2d3d(0x17e)]['increment'](-_0x3e50f0['quantity']);}await database[_0x4e2d3d(0x1d4)]()[_0x4e2d3d(0x274)](_0x2145d1),showToast(_0x4e2d3d(0x21b),_0x4e2d3d(0x278));const _0x5ccf8e={..._0x575ccb,'items':invoiceItems};showInvoice(_0x5ccf8e),resetSystem();}else _0x4e03ab=_0x355dda,_0x29b26f[_0x4e2d3d(0x276)][_0x4e2d3d(0x1a3)][_0x4e2d3d(0x2b5)]('active',_0x11c255===_0x4e2d3d(0x1c6)),_0x36bed3[_0x4e2d3d(0x270)][_0x4e2d3d(0x1a3)][_0x4e2d3d(0x2b5)](_0x4e2d3d(0x1b2),_0x3db09a===_0x4e2d3d(0x1d9)),_0x28c7f0[_0x4e2d3d(0x2d1)][_0x4e2d3d(0x1a3)][_0x4e2d3d(0x2b5)](_0x4e2d3d(0x1b2),_0x5ac6b2===_0x4e2d3d(0x1e6));}catch(_0x4e02ea){console[_0x4e2d3d(0x2ea)](_0x4e2d3d(0x21f),_0x4e02ea),showToast(_0x4e2d3d(0x22d)+_0x4e02ea[_0x4e2d3d(0x225)],'error');}}),elements[_0x4a48b6(0x19a)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),function(){const _0x36e535=_0x4a48b6;confirm(_0x36e535(0x1ad))&&(_0x36e535(0x1b5)===_0x36e535(0x1b5)?(resetSystem(),showToast(_0x36e535(0x17c),_0x36e535(0x1df))):(_0x240a60[_0x36e535(0x203)][_0x36e535(0x238)]=_0x23c429,_0x1cbab3['returnSuccessNotice'][_0x36e535(0x258)]['display']=_0x36e535(0x2cb),_0x1e0280(()=>{const _0x7bcd7b=_0x36e535;_0x43c8f8['returnSuccessNotice'][_0x7bcd7b(0x258)][_0x7bcd7b(0x2fc)]='none';},0xbb8)));});function showInvoice(_0x20e1e3){const _0x19c065=_0x4a48b6,_0xafbe74=encodeURIComponent(JSON[_0x19c065(0x2c9)](_0x20e1e3)),_0x339324=document[_0x19c065(0x1af)](_0x19c065(0x181));_0x339324['id']=_0x19c065(0x2b0),_0x339324['style'][_0x19c065(0x248)]=_0x19c065(0x262),elements['invoicePlaceholder'][_0x19c065(0x28a)]='',elements[_0x19c065(0x20f)]['appendChild'](_0x339324),elements['invoicePlaceholder'][_0x19c065(0x258)]['display']=_0x19c065(0x2cb),elements[_0x19c065(0x259)][_0x19c065(0x258)][_0x19c065(0x2fc)]=_0x19c065(0x305),elements[_0x19c065(0x2c0)]['style'][_0x19c065(0x2fc)]=_0x19c065(0x305),_0x339324[_0x19c065(0x213)]=_0x19c065(0x28e)+_0xafbe74;}elements['returnModeBtn'][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),()=>{const _0x37504f=_0x4a48b6;elements[_0x37504f(0x263)][_0x37504f(0x258)]['display']=_0x37504f(0x223),elements[_0x37504f(0x245)][_0x37504f(0x2dc)]();}),elements[_0x4a48b6(0x157)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),()=>{const _0x596f2f=_0x4a48b6;elements[_0x596f2f(0x263)][_0x596f2f(0x258)]['display']=_0x596f2f(0x305),elements[_0x596f2f(0x15a)]['innerHTML']='',elements[_0x596f2f(0x245)][_0x596f2f(0x279)]='';}),elements[_0x4a48b6(0x158)]['addEventListener'](_0x4a48b6(0x168),findInvoice),elements['invoiceSearchInput'][_0x4a48b6(0x2fa)]('keypress',_0x3c9e77=>{const _0xce6574=_0x4a48b6;if(_0x3c9e77[_0xce6574(0x202)]===_0xce6574(0x177))findInvoice();});async function findInvoice(){const _0x1522dc=_0x4a48b6,_0x2b57ac=elements['invoiceSearchInput'][_0x1522dc(0x279)][_0x1522dc(0x15c)]();if(!_0x2b57ac){if('LpaMl'!=='LpaMl')_0x147761(_0x10e3ba(this[_0x1522dc(0x2a6)][_0x1522dc(0x190)]),_0x4fcb6d(this[_0x1522dc(0x279)]));else{showToast(_0x1522dc(0x220),_0x1522dc(0x275));return;}}elements[_0x1522dc(0x15a)]['innerHTML']=_0x1522dc(0x1dc);let _0xb7a7be=null;const _0x28f9a8=await database['ref'](_0x1522dc(0x239)+_0x2b57ac)['once']('value');if(_0x28f9a8[_0x1522dc(0x16a)]())_0xb7a7be=_0x28f9a8;else{const _0x53befe=!_0x2b57ac[_0x1522dc(0x20e)]('-')&&_0x2b57ac[_0x1522dc(0x1b1)]===0x13&&/^[A-Za-z0-9_-]+$/[_0x1522dc(0x1c2)](_0x2b57ac);if(_0x53befe){if(_0x1522dc(0x26a)===_0x1522dc(0x26a)){const _0x2384f6='-'+_0x2b57ac,_0xc7cf36=await database[_0x1522dc(0x1d4)](_0x1522dc(0x239)+_0x2384f6)[_0x1522dc(0x207)](_0x1522dc(0x279));_0xc7cf36[_0x1522dc(0x16a)]()&&(_0xb7a7be=_0xc7cf36);}else{_0x35d72e(_0x1522dc(0x255),_0x1522dc(0x275));return;}}}if(_0xb7a7be){if('ieVdd'===_0x1522dc(0x209)){const _0x1a13ef=_0x24f8d6[_0x1522dc(0x1af)]('div');_0x1a13ef[_0x1522dc(0x289)]=_0x1522dc(0x260);const _0x54d338=new _0x4a0881(),_0x2ede94=new _0x2a6bca(_0x11ed99[_0x1522dc(0x162)]),_0x36160c=_0x4d73da[_0x1522dc(0x1a8)]((_0x2ede94-_0x54d338)/(0x3e8*0x3c*0x3c*0x18));let _0x1affb3='';if(_0x36160c<0x0)_0x1affb3=_0x1522dc(0x28c);else{if(_0x36160c<=0x1e)_0x1affb3='<span\x20class=\x22batch-expiry\x20near-expiry\x22>(متبقي\x20'+_0x36160c+_0x1522dc(0x1a9);else _0x1affb3='<span\x20class=\x22batch-expiry\x20valid\x22>(صالحة)</span>';}_0x1a13ef['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-title\x22>الدفعة:\x20'+(_0x1c8b17[_0x1522dc(0x273)]||_0x1a82df['id'])+_0x1522dc(0x246)+_0x4c4959[_0x1522dc(0x24b)]+_0x1522dc(0x193)+_0x1affb3+_0x1522dc(0x2c2)+_0x22cb3f['id']+_0x1522dc(0x18f);const _0x4b1dd2=_0x1a13ef['querySelector'](_0x1522dc(0x1d3));if(_0x177057['quantity']<=0x0||_0x36160c<0x0)_0x4b1dd2[_0x1522dc(0x18e)]=!![];_0x4b1dd2[_0x1522dc(0x2fa)](_0x1522dc(0x168),()=>_0x2aacc8(_0x4f1bb4)),_0x5c8467[_0x1522dc(0x1d0)][_0x1522dc(0x2b3)](_0x1a13ef);}else{displayFoundInvoice(_0xb7a7be['key'],_0xb7a7be[_0x1522dc(0x268)]());return;}}const _0x103864=database[_0x1522dc(0x1d4)]('invoices');_0x103864[_0x1522dc(0x207)](_0x1522dc(0x279))[_0x1522dc(0x28d)](_0x20f7d0=>{const _0x8ab31a=_0x1522dc;if('ZeqLZ'!==_0x8ab31a(0x2b9)){const _0x57dd7d=[];_0x20f7d0['exists']()&&('VArGB'!==_0x8ab31a(0x170)?_0x15ec3b=!![]:_0x20f7d0['forEach'](_0x2a2d4b=>{const _0x910c1c=_0x8ab31a,_0xf486e1=_0x2a2d4b['val'](),_0xbd7d98=_0xf486e1[_0x910c1c(0x204)]||{};for(const _0x58e2d7 in _0xbd7d98){if(_0xbd7d98[_0x58e2d7]['barcode']===_0x2b57ac){if(_0x910c1c(0x1c8)!==_0x910c1c(0x1c8))_0x33e9d1['invoiceDiscountSection'][_0x910c1c(0x258)][_0x910c1c(0x2fc)]=_0x1001b0['invoiceDiscountSection'][_0x910c1c(0x258)][_0x910c1c(0x2fc)]===_0x910c1c(0x2cb)?'none':_0x910c1c(0x2cb);else{_0x57dd7d['push']({'id':_0x2a2d4b[_0x910c1c(0x202)],'data':_0xf486e1});break;}}}}));if(_0x57dd7d[_0x8ab31a(0x1b1)]===0x0)elements[_0x8ab31a(0x15a)][_0x8ab31a(0x28a)]=_0x8ab31a(0x216);else{if(_0x57dd7d[_0x8ab31a(0x1b1)]===0x1){const _0x53f8e8=_0x57dd7d[0x0];displayFoundInvoice(_0x53f8e8['id'],_0x53f8e8['data']);}else displayInvoiceList(_0x57dd7d);}}else _0x2cbe87[_0x8ab31a(0x24b)]=_0x2bd61a,_0x369cfc[_0x8ab31a(0x2f5)]=_0x38498b[_0x8ab31a(0x264)][_0x8ab31a(0x2bf)]*_0x11f515,_0x27f13b('+1\x20'+_0x2357b9[_0x8ab31a(0x264)][_0x8ab31a(0x1b6)]+'\x20(الإجمالي:\x20'+_0x29d04d+')','info');})[_0x1522dc(0x1cc)](_0x4bbc1f=>{const _0x242a2c=_0x1522dc;if('dZcrN'!==_0x242a2c(0x24f)){_0x2479af(_0x242a2c(0x267)+_0x2f33c1+_0x242a2c(0x243)+_0x2ec0b2+')',_0x242a2c(0x2ea)),_0x321cd0[_0x242a2c(0x1e3)]['querySelector'](_0x242a2c(0x15b)+_0x27c13b+'\x22]')[_0x242a2c(0x279)]=_0x193a83[_0x242a2c(0x24b)];return;}else elements[_0x242a2c(0x15a)][_0x242a2c(0x28a)]=_0x242a2c(0x205),console[_0x242a2c(0x2ea)](_0x242a2c(0x23e),_0x4bbc1f);});}function displayInvoiceList(_0x787b24){const _0x2061ae=_0x4a48b6;elements[_0x2061ae(0x15a)][_0x2061ae(0x28a)]=_0x2061ae(0x1c3),_0x787b24[_0x2061ae(0x22f)]((_0x10ee38,_0x5141ed)=>new Date(_0x5141ed[_0x2061ae(0x24e)][_0x2061ae(0x2a5)])-new Date(_0x10ee38[_0x2061ae(0x24e)][_0x2061ae(0x2a5)])),_0x787b24[_0x2061ae(0x195)](_0x5b4011=>{const _0x2e9028=_0x2061ae,_0x1d6e81=document['createElement'](_0x2e9028(0x25a));_0x1d6e81['className']='invoice-item-card',_0x1d6e81[_0x2e9028(0x258)]['cursor']=_0x2e9028(0x1e7),_0x1d6e81[_0x2e9028(0x258)][_0x2e9028(0x2ee)]='10px',_0x1d6e81['innerHTML']=_0x2e9028(0x284)+_0x5b4011['id']+_0x2e9028(0x22e)+formatDate(_0x5b4011['data'][_0x2e9028(0x2a5)])+_0x2e9028(0x1ec)+_0x5b4011[_0x2e9028(0x24e)][_0x2e9028(0x242)][_0x2e9028(0x2e2)](0x2)+_0x2e9028(0x254),_0x1d6e81[_0x2e9028(0x2fa)](_0x2e9028(0x168),()=>{const _0xacdba0=_0x2e9028;displayFoundInvoice(_0x5b4011['id'],_0x5b4011[_0xacdba0(0x24e)]);}),elements['invoiceSearchResult'][_0x2e9028(0x2b3)](_0x1d6e81);});}function _0x5593(_0x49484d,_0x2a6ed0){const _0x538c53=_0xdbb1();return _0x5593=function(_0x6e180e,_0x395065){_0x6e180e=_0x6e180e-0x154;let _0x29c31c=_0x538c53[_0x6e180e];return _0x29c31c;},_0x5593(_0x49484d,_0x2a6ed0);}function displayFoundInvoice(_0x7302e7,_0x4ae709){const _0x1d3a80=_0x4a48b6;elements[_0x1d3a80(0x15a)]['innerHTML']='';const _0xbda16b=document[_0x1d3a80(0x1af)](_0x1d3a80(0x25a));_0xbda16b[_0x1d3a80(0x258)][_0x1d3a80(0x248)]=_0x1d3a80(0x2df),_0xbda16b['innerHTML']=_0x1d3a80(0x164)+_0x7302e7+_0x1d3a80(0x28b)+formatDate(_0x4ae709[_0x1d3a80(0x2a5)])+_0x1d3a80(0x228)+_0x4ae709['finalPrice'][_0x1d3a80(0x2e2)](0x2)+_0x1d3a80(0x2fd),elements['invoiceSearchResult']['appendChild'](_0xbda16b);const _0x5c2bb5=_0x4ae709[_0x1d3a80(0x204)]||{};for(const _0x449454 in _0x5c2bb5){const _0x40c234=_0x5c2bb5[_0x449454],_0x227ff3=document[_0x1d3a80(0x1af)]('div');_0x227ff3[_0x1d3a80(0x289)]=_0x1d3a80(0x29e);const _0x344d5b=_0x40c234[_0x1d3a80(0x24b)]||0x0,_0x12ae68=_0x40c234[_0x1d3a80(0x26b)]||0x0,_0x1e7d0a=_0x344d5b-_0x12ae68;_0x227ff3[_0x1d3a80(0x28a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-name\x22>'+_0x40c234[_0x1d3a80(0x1b6)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20الكمية\x20المباعة:\x20'+_0x344d5b+'\x20|\x20الكمية\x20المرتجعة:\x20'+_0x12ae68+_0x1d3a80(0x266)+(_0x40c234[_0x1d3a80(0x300)]['batchNumber']||_0x40c234[_0x1d3a80(0x300)]['id'])+_0x1d3a80(0x1f1)+_0x7302e7+_0x1d3a80(0x15d)+_0x449454+_0x1d3a80(0x185)+_0x40c234[_0x1d3a80(0x1b6)]+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-barcode=\x22'+_0x40c234[_0x1d3a80(0x221)]+_0x1d3a80(0x198)+_0x40c234[_0x1d3a80(0x300)]['id']+_0x1d3a80(0x2cc)+_0x1e7d0a+_0x1d3a80(0x232)+(_0x1e7d0a<=0x0?'disabled':'')+_0x1d3a80(0x1bf)+(_0x1e7d0a<=0x0?_0x1d3a80(0x2db):'إرجاع')+_0x1d3a80(0x1aa),elements[_0x1d3a80(0x15a)]['appendChild'](_0x227ff3);}elements[_0x1d3a80(0x15a)]['querySelectorAll']('.item-return-btn')[_0x1d3a80(0x195)](_0x4ef005=>{const _0x1939e2=_0x1d3a80;_0x1939e2(0x27b)!==_0x1939e2(0x27b)?_0x5c885d[_0x1939e2(0x241)][_0x1939e2(0x25c)]=_0x1939e2(0x1bb):_0x4ef005['addEventListener'](_0x1939e2(0x168),initiateItemReturn);});}function initiateItemReturn(_0x3a0197){const _0x581272=_0x4a48b6,_0x1b2094=_0x3a0197[_0x581272(0x2c4)],_0x5e8aff=parseInt(_0x1b2094[_0x581272(0x2a6)][_0x581272(0x295)]);if(_0x5e8aff<=0x0){showToast(_0x581272(0x251),_0x581272(0x275));return;}currentItemForReturn={..._0x1b2094['dataset']},elements[_0x581272(0x1fc)][_0x581272(0x238)]='إرجاع\x20منتج:\x20'+currentItemForReturn[_0x581272(0x25e)],elements[_0x581272(0x1f8)][_0x581272(0x279)]=0x1,elements[_0x581272(0x1f8)][_0x581272(0x294)]=_0x5e8aff,elements[_0x581272(0x1f0)]['value']='',elements['returnConfirmModal'][_0x581272(0x258)][_0x581272(0x2fc)]=_0x581272(0x223);}elements[_0x4a48b6(0x1dd)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),async()=>{const _0x5b7a28=_0x4a48b6;if(!currentItemForReturn)return;const _0x563148=parseInt(elements[_0x5b7a28(0x1f8)]['value']),_0x3a5f4a=elements[_0x5b7a28(0x1f0)][_0x5b7a28(0x279)]['trim']()||_0x5b7a28(0x1f2),_0xf5bb9f=parseInt(currentItemForReturn[_0x5b7a28(0x295)]);if(isNaN(_0x563148)||_0x563148<=0x0){showToast(_0x5b7a28(0x233),'warning');return;}if(_0x563148>_0xf5bb9f){showToast(_0x5b7a28(0x176)+_0xf5bb9f+').',_0x5b7a28(0x2ea));return;}try{if(_0x5b7a28(0x173)==='bwzUC'){const _0x16983e=database[_0x5b7a28(0x1d4)](_0x5b7a28(0x156))['push']();await _0x16983e[_0x5b7a28(0x20c)]({'invoiceId':currentItemForReturn['invoiceId'],'itemKey':currentItemForReturn[_0x5b7a28(0x160)],'barcode':currentItemForReturn[_0x5b7a28(0x221)],'itemName':currentItemForReturn['itemName'],'quantityReturned':_0x563148,'reason':_0x3a5f4a,'returnDate':new Date()[_0x5b7a28(0x218)]()});const _0x4c35ec=database[_0x5b7a28(0x1d4)]('invoices/'+currentItemForReturn['invoiceId']+_0x5b7a28(0x215)+currentItemForReturn[_0x5b7a28(0x160)]+_0x5b7a28(0x24d));await _0x4c35ec[_0x5b7a28(0x27e)](_0x45c3ab=>(_0x45c3ab||0x0)+_0x563148);const _0x1a8718='products/'+currentItemForReturn[_0x5b7a28(0x221)]+'/batches/'+currentItemForReturn[_0x5b7a28(0x1b8)]+_0x5b7a28(0x1d2);await database[_0x5b7a28(0x1d4)](_0x1a8718)[_0x5b7a28(0x20c)](firebase[_0x5b7a28(0x187)][_0x5b7a28(0x17e)][_0x5b7a28(0x2d6)](_0x563148)),elements[_0x5b7a28(0x208)][_0x5b7a28(0x258)]['display']=_0x5b7a28(0x305),showReturnSuccess(_0x5b7a28(0x1c0)+_0x563148+'\x20قطعة\x20من\x20'+currentItemForReturn[_0x5b7a28(0x25e)]+'\x20بنجاح.'),findInvoice();}else{if(_0x415f58[_0x5b7a28(0x202)]===_0x5b7a28(0x177))_0x4237b7();}}catch(_0x27dc7f){console[_0x5b7a28(0x2ea)](_0x5b7a28(0x1a1),_0x27dc7f),showToast(_0x5b7a28(0x301)+_0x27dc7f[_0x5b7a28(0x225)],_0x5b7a28(0x2ea));}finally{_0x5b7a28(0x235)!==_0x5b7a28(0x154)?currentItemForReturn=null:(_0x42eeba[_0x5b7a28(0x15a)][_0x5b7a28(0x28a)]=_0x5b7a28(0x1c3),_0x227467[_0x5b7a28(0x22f)]((_0x454e92,_0x271355)=>new _0x161a1a(_0x271355['data'][_0x5b7a28(0x2a5)])-new _0x2cc6e6(_0x454e92['data'][_0x5b7a28(0x2a5)])),_0xc2a072[_0x5b7a28(0x195)](_0x34dadb=>{const _0x5acd8a=_0x5b7a28,_0x2a1027=_0x27b90a[_0x5acd8a(0x1af)](_0x5acd8a(0x25a));_0x2a1027[_0x5acd8a(0x289)]='invoice-item-card',_0x2a1027['style'][_0x5acd8a(0x167)]='pointer',_0x2a1027['style']['marginBottom']=_0x5acd8a(0x1cb),_0x2a1027['innerHTML']=_0x5acd8a(0x284)+_0x34dadb['id']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22invoice-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20التاريخ:\x20'+_0xb84605(_0x34dadb[_0x5acd8a(0x24e)]['date'])+_0x5acd8a(0x1ec)+_0x34dadb[_0x5acd8a(0x24e)][_0x5acd8a(0x242)][_0x5acd8a(0x2e2)](0x2)+_0x5acd8a(0x254),_0x2a1027[_0x5acd8a(0x2fa)](_0x5acd8a(0x168),()=>{const _0x2c197f=_0x5acd8a;_0x3b0981(_0x34dadb['id'],_0x34dadb[_0x2c197f(0x24e)]);}),_0x316479[_0x5acd8a(0x15a)][_0x5acd8a(0x2b3)](_0x2a1027);}));}}),elements[_0x4a48b6(0x19c)][_0x4a48b6(0x2fa)](_0x4a48b6(0x168),()=>{const _0x44aa54=_0x4a48b6;elements[_0x44aa54(0x208)][_0x44aa54(0x258)][_0x44aa54(0x2fc)]=_0x44aa54(0x305),currentItemForReturn=null;});function showReturnSuccess(_0x18f0aa){const _0x437fa2=_0x4a48b6;elements['returnSuccessText'][_0x437fa2(0x238)]=_0x18f0aa,elements[_0x437fa2(0x1ea)][_0x437fa2(0x258)][_0x437fa2(0x2fc)]=_0x437fa2(0x2cb),setTimeout(()=>{const _0x46b009=_0x437fa2;_0x46b009(0x26f)===_0x46b009(0x1a7)?(_0x1211f5[_0x46b009(0x1b1)]==_0x5eeebd['length']||_0x5204ea['indexOf']('.')===0x0)&&(_0x2d0942=!![]):elements['returnSuccessNotice'][_0x46b009(0x258)][_0x46b009(0x2fc)]=_0x46b009(0x305);},0xbb8);}function resetSystem(){const _0x3ff5de=_0x4a48b6;elements[_0x3ff5de(0x2a9)][_0x3ff5de(0x279)]='',elements[_0x3ff5de(0x1e8)][_0x3ff5de(0x258)][_0x3ff5de(0x2fc)]=_0x3ff5de(0x305),elements[_0x3ff5de(0x2c0)][_0x3ff5de(0x258)]['display']=_0x3ff5de(0x305),elements[_0x3ff5de(0x2f7)][_0x3ff5de(0x258)][_0x3ff5de(0x2fc)]=_0x3ff5de(0x305);elements[_0x3ff5de(0x259)][_0x3ff5de(0x258)][_0x3ff5de(0x2fc)]!==_0x3ff5de(0x223)&&(_0x3ff5de(0x172)!==_0x3ff5de(0x163)?toggleSearch():_0x23e539[_0x3ff5de(0x2b6)]()[_0x3ff5de(0x23f)]());resetProductSelection(),invoiceItems=[],invoiceOverallDiscount={'type':_0x3ff5de(0x305),'value':0x0,'reason':''},currentSubTotal=0x0,currentFinalInvoicePrice=0x0,displayInvoiceItems(),calculateAndDisplayTotals(),elements['invoiceDiscountPercent'][_0x3ff5de(0x279)]='',elements['invoiceDiscountAmount'][_0x3ff5de(0x279)]='',elements['invoiceReasonInput'][_0x3ff5de(0x279)]='',setPaymentMethod(_0x3ff5de(0x1c6));if(cameraActive)stopCamera();}function resetProductSelection(){currentProduct=null,selectedBatch=null,isUpdatingItemIndex=null;}function showToast(_0x2903f3,_0x2be21c=_0x4a48b6(0x1df),_0x5db866=0xbb8){const _0x385042=_0x4a48b6,_0x3ff558=elements['toast'];_0x3ff558['textContent']=_0x2903f3,_0x3ff558[_0x385042(0x289)]=_0x385042(0x2e0);const _0x22d0cf={'success':_0x385042(0x271),'error':_0x385042(0x288),'warning':'linear-gradient(135deg,\x20#f8961e,\x20#f3722c)','info':_0x385042(0x175)};_0x3ff558['style'][_0x385042(0x180)]=_0x22d0cf[_0x2be21c]||_0x22d0cf[_0x385042(0x1df)],_0x3ff558['style'][_0x385042(0x2fc)]='block',setTimeout(()=>{const _0x38eeda=_0x385042;_0x38eeda(0x1fa)==='ZsxtC'?(_0x170c89[_0x38eeda(0x263)][_0x38eeda(0x258)]['display']='flex',_0x149da5[_0x38eeda(0x245)][_0x38eeda(0x2dc)]()):(_0x3ff558[_0x38eeda(0x1a3)][_0x38eeda(0x2c3)](_0x38eeda(0x2ab)),setTimeout(()=>{const _0x3dbd26=_0x38eeda;if('Wrihz'===_0x3dbd26(0x2d9))_0x3ff558[_0x3dbd26(0x258)][_0x3dbd26(0x2fc)]=_0x3dbd26(0x305),_0x3ff558[_0x3dbd26(0x1a3)][_0x3dbd26(0x197)](_0x3dbd26(0x2ab));else{_0x43f98f(_0x3dbd26(0x176)+_0x420470+').',_0x3dbd26(0x2ea));return;}},0x1f4));},_0x5db866);}window['addEventListener'](_0x4a48b6(0x225),function(_0x3943aa){const _0x3c3457=_0x4a48b6;_0x3943aa[_0x3c3457(0x24e)]==='closeInvoice'&&(elements['invoicePlaceholder'][_0x3c3457(0x258)]['display']='none',resetSystem());}),window[_0x4a48b6(0x2fa)](_0x4a48b6(0x2b8),stopCamera),displayInvoiceItems(),calculateAndDisplayTotals(),document['addEventListener'](_0x4a48b6(0x1fd),async function(){const _0x7c581e=_0x4a48b6;await fetchTranslations(),setLanguage(currentLang),firebase[_0x7c581e(0x2b6)]()[_0x7c581e(0x231)](function(_0x5d56d4){const _0x3b118e=_0x7c581e;_0x5d56d4?firebase[_0x3b118e(0x187)]()[_0x3b118e(0x1d4)]('user_roles/'+_0x5d56d4['uid'])[_0x3b118e(0x207)](_0x3b118e(0x279))['then'](_0x5dd19d=>{const _0x47baff=_0x3b118e;if(_0x5dd19d[_0x47baff(0x16a)]()){if(_0x47baff(0x21d)===_0x47baff(0x17d))for(let _0x4c026e=0x0;_0x4c026e<_0x3171ea[_0x47baff(0x1b1)];_0x4c026e+=0x2){if(_0x4435ac==_0x2e4d51[_0x4c026e]&&_0x255378['charCodeAt'](_0xbce1bc)!=_0x119e82[_0x4c026e+0x1])return![];}else initializeApp(_0x5d56d4,_0x5dd19d['val']()[_0x47baff(0x1b6)],_0x5dd19d['val']()['role']);}else firebase[_0x47baff(0x2b6)]()[_0x47baff(0x23f)]();})['catch'](_0x1811d0=>{const _0x539ef2=_0x3b118e;'RsQLp'!==_0x539ef2(0x2ba)?_0x202c24['invoiceDiscountSection'][_0x539ef2(0x258)]['display']=_0x539ef2(0x305):(console['error'](_0x1811d0),firebase[_0x539ef2(0x2b6)]()['signOut']());}):window[_0x3b118e(0x241)][_0x3b118e(0x25c)]=_0x3b118e(0x1bb);});});
        
    </script>
</body>
</html>
